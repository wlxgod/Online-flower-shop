Index: newsapp/routes.py
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>import os\r\nimport string\r\nimport pandas as pd\r\n\r\nfrom flask import render_template, flash, redirect, url_for, session, request, jsonify, make_response\r\nfrom sqlalchemy import and_,or_\r\nfrom werkzeug.security import generate_password_hash, check_password_hash\r\nfrom werkzeug.utils import secure_filename\r\nfrom matplotlib import pyplot as plt\r\nfrom datetime import datetime\r\n\r\n\r\n\r\nfrom newsapp import app, db, config\r\nfrom newsapp.forms import LoginForm, SignupForm, FlowerForm, ChangePasswordForm, CheckoutForm\r\nfrom newsapp.models import Flower, Orders, Basket, Message, Profile, News, Review, Want, Basketlike, Replyr\r\nfrom newsapp.models import User\r\n\r\nfrom flask_babel import Babel, gettext as _\r\n# from flask_babel import Babel\r\napp.config['BABEL_DEFAULT_LOCALE'] = 'en'\r\nbabel = Babel(app)\r\n\r\n@babel.localeselector\r\ndef get_locale(): # 核心，当网站含有locale的cookie，且符合['zh', 'en']\r\n    cookie = request.cookies.get('locale')\r\n    if cookie in ['zh', 'en']:\r\n        return cookie\r\n    return request.accept_languages.best_match(app.config.get('BABEL_DEFAULT_LOCALE')) # 没有cookie时，默认为 en\r\n\r\n@app.route('/set_locale/<locale>') # 用ajax请求来设置cookie\r\ndef set_locale(locale):\r\n    response = make_response(jsonify(message='update success'))\r\n    if locale:\r\n        response.set_cookie('locale', locale, 60 * 60)\r\n        return response\r\n\r\n@app.route('/test')\r\ndef test():\r\n    return render_template('test.html')\r\n\r\n@app.route('/')\r\n@app.route('/welcome')\r\ndef welcome():\r\n    return render_template('welcome.html')\r\n\r\n\r\n@app.route('/signup', methods=['GET', 'POST'])\r\ndef signup():\r\n    form = SignupForm()\r\n    if form.validate_on_submit():\r\n        if form.password.data != form.password2.data:\r\n            flash('Passwords do not match!')\r\n            return redirect(url_for('signup'))\r\n        passw_hash = generate_password_hash(form.password.data)\r\n        user = User(username=form.username.data, email=form.email.data, identity=\"customer\",password_hash=passw_hash)\r\n        db.session.add(user)\r\n        db.session.commit()\r\n        session[\"USERNAME\"] = user.username\r\n        user = User.query.filter(User.username == form.username.data).first()\r\n        id=user.id\r\n        name = form.username.data\r\n        img_dir = config.Config.PC_UPLOAD_DIR\r\n        print(img_dir)\r\n        img_obj = form.image.data\r\n        img_filename = session.get(\"USERNAME\") + name + str(0) + '_img.jpg'\r\n        img_obj.save(os.path.join(img_dir, img_filename))\r\n        profile=Profile(id=id,name=form.username.data,dob=\"2020-06-30\",gender=0,description=\"No description\",portrait=img_filename,user_id=id)\r\n        db.session.add(profile)\r\n        db.session.commit()\r\n        staff = User.query.filter(User.identity=='staff')\r\n        for s in staff:\r\n            news=News(number=0,sender_id=s.id,receiver_id=id,profile_id=s.id)\r\n            db.session.add(news)\r\n            db.session.commit()\r\n        return redirect('login')\r\n    return render_template('signup.html', title='Register a new user', form=form)\r\n\r\n\r\n@app.route('/signupch', methods=['GET', 'POST'])\r\ndef signupch():\r\n    form = SignupForm()\r\n    if form.validate_on_submit():\r\n        if form.password.data != form.password2.data:\r\n            flash('Passwords do not match!')\r\n            return redirect(url_for('signup'))\r\n        passw_hash = generate_password_hash(form.password.data)\r\n        user = User(username=form.username.data, email=form.email.data, password_hash=passw_hash)\r\n        db.session.add(user)\r\n        db.session.commit()\r\n        session[\"USERNAME\"] = user.username\r\n        return redirect('login')\r\n    return render_template('signupCh.html', title='新用户注册', form=form)\r\n\r\n\r\n\r\n@app.route('/login', methods=['GET', 'POST'])\r\ndef login():\r\n    form = LoginForm()\r\n    if form.validate_on_submit():\r\n        user = User.query.filter(User.username == form.username.data).first()\r\n        if user is None:\r\n            flash(\"Please Register or Retry With a Valid Username\")\r\n            return redirect(url_for('login'))\r\n        if not check_password_hash(user.password_hash, form.password.data):\r\n            flash('Wrong Password')\r\n            return redirect(url_for('login'))\r\n        if form.type.data=='1' and user.identity=='customer':\r\n            flash(\"As a customer,you can not come into the staff page.\")\r\n            return redirect(url_for('login'))\r\n        flash('Login Successfully')\r\n        session['USERNAME'] = user.username\r\n        session['COVID'] = 'False'\r\n        if form.type.data=='0':\r\n            return redirect('index')\r\n        if form.type.data=='1':\r\n            return redirect('addflower')\r\n    return render_template('login.html', title='Log in', form=form)\r\n\r\n\r\n@app.route('/loginch', methods=['GET', 'POST'])\r\ndef loginch():\r\n    form = LoginForm()\r\n    if form.validate_on_submit():\r\n        user = User.query.filter(User.username == form.username.data).first()\r\n        if user is None:\r\n            flash(\"请用有效的用户名注册或重试\")\r\n            return redirect(url_for('loginch'))\r\n        if not check_password_hash(user.password_hash, form.password.data):\r\n            flash('错误的密码')\r\n            return redirect(url_for('loginch'))\r\n        if form.type.data == '1' and user.identity == 'customer':\r\n            flash(\"作为一个顾客，你不能进入员工端\")\r\n            return redirect(url_for('loginch'))\r\n        flash('登陆成功')\r\n        session['USERNAME'] = user.username\r\n        session['COVID'] = 'False'\r\n        if form.type.data == '0':\r\n            return redirect('index')\r\n        if form.type.data == '1':\r\n            return redirect('addflower')\r\n    return render_template('loginCh.html', title='登录', form=form)\r\n\r\n\r\n\r\n\r\n# new index page!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\r\n# !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\r\n@app.route('/index', methods=['GET', 'POST'])\r\ndef index():\r\n    \"\"\"flower = Flower(name=\"rose\", intro=\"DO the test\", price=100,\r\n                    number=50, img=\"signup.jfif\" ,address=\"CHINESE FOREVER ROAD\")\r\n    db.session.add(flower)\r\n    db.session.commit()\"\"\"\r\n    \"\"\"form=SearchForm()\"\"\"\r\n    posts_query = Flower.query\r\n    posts = posts_query.filter().all()\r\n    posts2 = posts\r\n    username = session.get(\"USERNAME\")\r\n    sessionstatue=session.get(\"COVID\")\r\n    print(sessionstatue)\r\n    users = User.query.filter(User.username == username)\r\n    user=users.first()\r\n    user_id = user.id\r\n    order_in_db = Orders.query.filter(and_(Orders.state == \"unpayment\", Orders.user_id == user_id)).first()\r\n    order_in_dbs = Orders.query.filter().all()\r\n    print(order_in_dbs)\r\n    print(\"---------------------------------\")\r\n    \"\"\"order_in_db=order_in_dbs.first()\"\"\"\r\n    want_in_db = Want.query.filter(Want.user_id == user_id).first()\r\n    if want_in_db is None:\r\n        want = Want(user_id=user.id)\r\n        db.session.add(want)\r\n        db.session.commit()\r\n    if order_in_db is None:\r\n        order = Orders(price=0, name=user.username, destination=\"Beijing university of technology\",\r\n                      state=\"unpayment\", number=100, way=\"deliver\", user_id=user.id)\r\n        db.session.add(order)\r\n        db.session.commit()\r\n        order_in_db = Orders.query.filter(and_(Orders.state == \"unpayment\", Orders.user_id == user_id)).first()\r\n    want_in_db = Want.query.filter(Want.user_id == user_id).first()\r\n    basket_in_db_list = Basket.query.filter(and_(Basket.order_id == order_in_db.id, Basket.user_id == user_id)).all()\r\n    basketlike_in_db_list = Basketlike.query.filter(Basketlike.want_id == want_in_db.id, Basketlike.user_id == user_id).all()\r\n    basket_length = len(basket_in_db_list)\r\n    basketlike_length = len(basketlike_in_db_list)\r\n    '''print(posts)'''\r\n    total = 0\r\n    for basket in basket_in_db_list:\r\n        total = total + basket.total*basket.quantity\r\n    content = None\r\n    content = request.form.get('content')\r\n    print(content)\r\n    if content is not None and content != \"搜索\" and content!=\"\":\r\n        posts2 = Flower.query.filter(Flower.name == content).all()\r\n        content = \"\"\r\n    return render_template('newindex.html', posts=posts, baskets=basket_in_db_list, length=basket_length, total=total,\r\n                           order=order_in_db, posts2=posts2,basketslike=basketlike_in_db_list, lengthlike=basketlike_length,sessionstatue=sessionstatue)\r\n\r\n\r\n\r\n# 原来的category页面\r\n@app.route('/shop', methods=['GET', 'POST'])\r\ndef shop():\r\n    \"\"\"flower = Flower(name=\"rose\", intro=\"DO the test\", price=100,\r\n                    number=50, img=\"signup.jfif\" ,address=\"CHINESE FOREVER ROAD\")\r\n    db.session.add(flower)\r\n    db.session.commit()\"\"\"\r\n    posts_query = Flower.query\r\n    posts = posts_query.filter().all()\r\n    posts2 = posts\r\n    posts3 = posts\r\n    username = session.get(\"USERNAME\")\r\n    users = User.query.filter(User.username == username)\r\n    user = users.first()\r\n    user_id = user.id\r\n    order_in_db = Orders.query.filter(and_(Orders.state == \"unpayment\", Orders.user_id == user_id)).first()\r\n    order_in_dbs = Orders.query.filter().all()\r\n    print(order_in_dbs)\r\n    print(\"---------------------------------\")\r\n    \"\"\"order_in_db=order_in_dbs.first()\"\"\"\r\n    want_in_db = Want.query.filter(Want.user_id == user_id).first()\r\n    if want_in_db is None:\r\n        want = Want(user_id=user.id)\r\n        db.session.add(want)\r\n        db.session.commit()\r\n    if order_in_db is None:\r\n        order = Orders(price=0, name=user.username, destination=\"Beijing university of technology\",\r\n                       state=\"unpayment\", number=100, way=\"deliver\", user_id=user.id)\r\n        db.session.add(order)\r\n        db.session.commit()\r\n        order_in_db = Orders.query.filter(and_(Orders.state == \"unpayment\", Orders.user_id == user_id)).first()\r\n    want_in_db = Want.query.filter(Want.user_id == user_id).first()\r\n    basket_in_db_list = Basket.query.filter(and_(Basket.order_id == order_in_db.id, Basket.user_id == user_id)).all()\r\n    basketlike_in_db_list = Basketlike.query.filter(Basketlike.want_id == want_in_db.id,\r\n                                                    Basketlike.user_id == user_id).all()\r\n    basket_length = len(basket_in_db_list)\r\n    basketlike_length = len(basketlike_in_db_list)\r\n    '''print(posts)'''\r\n    total = 0\r\n    for basket in basket_in_db_list:\r\n        total = total + basket.total*basket.quantity\r\n    content = None\r\n    content = request.form.get('amount')\r\n    if content!=None:\r\n        content1=content.split(' ')\r\n        print(content.split(' '))\r\n        num=[]\r\n        for i in content1:\r\n            if i!='' and i!='-':\r\n                num.append(i.split('$')[1])\r\n        low=int(num[0])\r\n        hign=int(num[1])\r\n        posts2 = Flower.query.filter(and_(Flower.price>=low,Flower.price<=hign)).all()\r\n        print(posts)\r\n        print(posts2)\r\n    p = 'default'\r\n    content2 = None\r\n    content2 = request.form.get('content')\r\n    if content2 is not None and content2 != \"搜索\" and content2 != \"\":\r\n        posts3 = Flower.query.filter(Flower.name == content2).all()\r\n        content2 = \"\"\r\n    print(len(posts))\r\n    print(posts3)\r\n    print(posts2)\r\n    print(posts3==posts)\r\n    return render_template('newshop.html', posts=posts, posts2=posts2, posts3=posts3,baskets=basket_in_db_list, length=basket_length, total=total,\r\n                           order=order_in_db, p=p,basketslike=basketlike_in_db_list, lengthlike=basketlike_length,postslength=len(posts),posts3length=len(posts3))\r\n\r\n\r\n@app.route('/SortByAZ', methods=['GET', 'POST'])\r\ndef SortByAZ():\r\n    \"\"\"flower = Flower(name=\"rose\", intro=\"DO the test\", price=100,\r\n                    number=50, img=\"signup.jfif\" ,address=\"CHINESE FOREVER ROAD\")\r\n    db.session.add(flower)\r\n    db.session.commit()\"\"\"\r\n    posts_query = Flower.query\r\n    posts = posts_query.order_by(Flower.name).all()\r\n    posts2 = posts\r\n    username = session.get(\"USERNAME\")\r\n    user = User.query.filter(User.username == username).first()\r\n    user_id = user.id\r\n    order_in_db = Orders.query.filter(and_(Orders.state == \"unpayment\", Orders.user_id == user_id)).first()\r\n    if order_in_db is None:\r\n        order = Orders(price=0, name=user.username, destination=\"Beijing university of technology\",\r\n                      state=\"unpayment\", number=100, way=\"deliver\", user_id=user.id)\r\n        db.session.add(order)\r\n        db.session.commit()\r\n    order_in_db = Orders.query.filter(and_(Orders.state == \"unpayment\", Orders.user_id == user_id)).first()\r\n    basket_in_db_list = Basket.query.filter(and_(Basket.order_id == order_in_db.id, Basket.user_id == user_id)).all()\r\n    basket_length = len(basket_in_db_list)\r\n    want_in_db = Want.query.filter(Want.user_id == user_id).first()\r\n    basketlike_in_db_list = Basketlike.query.filter(Basketlike.want_id == want_in_db.id,\r\n                                                    Basketlike.user_id == user_id).all()\r\n    basketlike_length = len(basketlike_in_db_list)\r\n    total = 0\r\n    for basket in basket_in_db_list:\r\n        total = total + basket.total*basket.quantity\r\n    content = None\r\n    content = request.form.get('amount')\r\n    if content!=None:\r\n        content1=content.split(' ')\r\n        print(content.split(' '))\r\n        num=[]\r\n        for i in content1:\r\n            if i!='' and i!='-':\r\n                num.append(i.split('$')[1])\r\n        low=int(num[0])\r\n        hign=int(num[1])\r\n        posts2 = Flower.query.filter(and_(Flower.price>=low,Flower.price<=hign)).all()\r\n        print(posts)\r\n        print(posts2)\r\n    print(posts2)\r\n    p = 'AZ'\r\n    return render_template('newshop.html', posts=posts, posts2=posts2, posts3=posts,baskets=basket_in_db_list, length=basket_length,\r\n                           total=total, order=order_in_db, p=p,basketslike=basketlike_in_db_list, lengthlike=basketlike_length,postslength=len(posts),posts3length=len(posts2))\r\n\r\n\r\n@app.route('/SortByZA', methods=['GET', 'POST'])\r\ndef SortByZA():\r\n    \"\"\"flower = Flower(name=\"rose\", intro=\"DO the test\", price=100,\r\n                    number=50, img=\"signup.jfif\" ,address=\"CHINESE FOREVER ROAD\")\r\n    db.session.add(flower)\r\n    db.session.commit()\"\"\"\r\n    posts_query = Flower.query\r\n    posts = posts_query.order_by(Flower.name.desc()).all()\r\n    posts2 = posts\r\n    username = session.get(\"USERNAME\")\r\n    user = User.query.filter(User.username == username).first()\r\n    user_id = user.id\r\n    order_in_db = Orders.query.filter(and_(Orders.state == \"unpayment\", Orders.user_id == user_id)).first()\r\n    if order_in_db is None:\r\n        order = Orders(price=0, name=user.username, destination=\"Beijing university of technology\",\r\n                      state=\"unpayment\", number=100, way=\"deliver\", user_id=user.id)\r\n        db.session.add(order)\r\n        db.session.commit()\r\n    order_in_db = Orders.query.filter(and_(Orders.state == \"unpayment\", Orders.user_id == user_id)).first()\r\n    basket_in_db_list = Basket.query.filter(and_(Basket.order_id == order_in_db.id, Basket.user_id == user_id)).all()\r\n    basket_length = len(basket_in_db_list)\r\n    '''print(posts)'''\r\n    total = 0\r\n    want_in_db = Want.query.filter(Want.user_id == user_id).first()\r\n    basketlike_in_db_list = Basketlike.query.filter(Basketlike.want_id == want_in_db.id,\r\n                                                    Basketlike.user_id == user_id).all()\r\n    basketlike_length = len(basketlike_in_db_list)\r\n    for basket in basket_in_db_list:\r\n        total = total + basket.total*basket.quantity\r\n    content = None\r\n    content = request.form.get('amount')\r\n    if content!=None:\r\n        content1=content.split(' ')\r\n        print(content.split(' '))\r\n        num=[]\r\n        for i in content1:\r\n            if i!='' and i!='-':\r\n                num.append(i.split('$')[1])\r\n        low=int(num[0])\r\n        hign=int(num[1])\r\n        posts2 = Flower.query.filter(and_(Flower.price>=low,Flower.price<=hign)).all()\r\n        print(posts)\r\n        print(posts2)\r\n    print(posts2)\r\n    p = 'ZA'\r\n    return render_template('newshop.html', posts=posts, posts2=posts2,posts3=posts, baskets=basket_in_db_list, length=basket_length,\r\n                           total=total, order=order_in_db, p=p,basketslike=basketlike_in_db_list, lengthlike=basketlike_length,postslength=len(posts),posts3length=len(posts2))\r\n\r\n\r\n@app.route('/SortByP', methods=['GET', 'POST'])\r\ndef SortByP():\r\n    \"\"\"flower = Flower(name=\"rose\", intro=\"DO the test\", price=100,\r\n                    number=50, img=\"signup.jfif\" ,address=\"CHINESE FOREVER ROAD\")\r\n    db.session.add(flower)\r\n    db.session.commit()\"\"\"\r\n    posts_query = Flower.query\r\n    posts = posts_query.order_by(Flower.price).all()\r\n    posts2 = posts\r\n    username = session.get(\"USERNAME\")\r\n    user = User.query.filter(User.username == username).first()\r\n    user_id = user.id\r\n    order_in_db = Orders.query.filter(and_(Orders.state == \"unpayment\", Orders.user_id == user_id)).first()\r\n    if order_in_db is None:\r\n        order = Orders(price=0, name=user.username, destination=\"Beijing university of technology\",\r\n                      state=\"unpayment\", number=100, way=\"deliver\", user_id=user.id)\r\n        db.session.add(order)\r\n        db.session.commit()\r\n    order_in_db = Orders.query.filter(and_(Orders.state == \"unpayment\", Orders.user_id == user_id)).first()\r\n    basket_in_db_list = Basket.query.filter(and_(Basket.order_id == order_in_db.id, Basket.user_id == user_id)).all()\r\n    basket_length = len(basket_in_db_list)\r\n    '''print(posts)'''\r\n    total = 0\r\n    want_in_db = Want.query.filter(Want.user_id == user_id).first()\r\n    basketlike_in_db_list = Basketlike.query.filter(Basketlike.want_id == want_in_db.id,\r\n                                                    Basketlike.user_id == user_id).all()\r\n    basketlike_length = len(basketlike_in_db_list)\r\n    for basket in basket_in_db_list:\r\n        total = total + basket.total*basket.quantity\r\n    content = None\r\n    content = request.form.get('amount')\r\n    if content!=None:\r\n        content1=content.split(' ')\r\n        print(content.split(' '))\r\n        num=[]\r\n        for i in content1:\r\n            if i!='' and i!='-':\r\n                num.append(i.split('$')[1])\r\n        low=int(num[0])\r\n        hign=int(num[1])\r\n        posts2 = Flower.query.filter(and_(Flower.price>=low,Flower.price<=hign)).all()\r\n        print(posts)\r\n        print(posts2)\r\n    print(posts2)\r\n    p = 'price'\r\n    return render_template('newshop.html', posts=posts, posts2=posts2, posts3=posts,baskets=basket_in_db_list, length=basket_length,\r\n                           total=total, order=order_in_db, p=p,basketslike=basketlike_in_db_list, lengthlike=basketlike_length,postslength=len(posts),posts3length=len(posts2))\r\n\r\n@app.route('/SortByS', methods=['GET', 'POST'])\r\ndef SortByS():\r\n    \"\"\"flower = Flower(name=\"rose\", intro=\"DO the test\", price=100,\r\n                    number=50, img=\"signup.jfif\" ,address=\"CHINESE FOREVER ROAD\")\r\n    db.session.add(flower)\r\n    db.session.commit()\"\"\"\r\n    posts_query = Flower.query\r\n    posts = posts_query.all()\r\n    orders = Orders.query.filter(Orders.state != 'unpayment').all()\r\n    baskets = []\r\n    Nbaskets = []\r\n    sort = {}\r\n    so = []\r\n    posts2 = []\r\n    for p in posts:\r\n        sort[p] = 0\r\n    for o in orders:\r\n        if Basket.query.filter(Basket.order_id == o.id).first() is not None:\r\n            baskets.append(Basket.query.filter(Basket.order_id == o.id).all())\r\n    for b in baskets:\r\n        for c in b:\r\n            Nbaskets.append(c)\r\n    for p in posts:\r\n        for n in Nbaskets:\r\n            if p.id == n.flower_id:\r\n                sort[p] = sort.get(p)+n.quantity\r\n    for s in sort:\r\n        so.append(sort.get(s))\r\n    so.sort(reverse=True)\r\n    for s in so:\r\n        if so.count(s) > 1:\r\n            so.remove(s)\r\n    print(so)\r\n    for s in so:\r\n        for i in sort:\r\n            if s == sort.get(i):\r\n                posts2.append(i)\r\n    print(sort)\r\n    print(posts2)\r\n    username = session.get(\"USERNAME\")\r\n    user = User.query.filter(User.username == username).first()\r\n    user_id = user.id\r\n    order_in_db = Orders.query.filter(and_(Orders.state == \"unpayment\", Orders.user_id == user_id)).first()\r\n    if order_in_db is None:\r\n        order = Orders(price=0, name=user.username, destination=\"Beijing university of technology\",\r\n                      state=\"unpayment\", number=100, way=\"deliver\", user_id=user.id)\r\n        db.session.add(order)\r\n        db.session.commit()\r\n    order_in_db = Orders.query.filter(and_(Orders.state == \"unpayment\", Orders.user_id == user_id)).first()\r\n    basket_in_db_list = Basket.query.filter(and_(Basket.order_id == order_in_db.id, Basket.user_id == user_id)).all()\r\n    basket_length = len(basket_in_db_list)\r\n    '''print(posts)'''\r\n    total = 0\r\n    want_in_db = Want.query.filter(Want.user_id == user_id).first()\r\n    basketlike_in_db_list = Basketlike.query.filter(Basketlike.want_id == want_in_db.id,\r\n                                                    Basketlike.user_id == user_id).all()\r\n    basketlike_length = len(basketlike_in_db_list)\r\n    for basket in basket_in_db_list:\r\n        total = total + basket.total*basket.quantity\r\n    content = None\r\n    content = request.form.get('amount')\r\n    if content!=None:\r\n        content1=content.split(' ')\r\n        print(content.split(' '))\r\n        num=[]\r\n        for i in content1:\r\n            if i!='' and i!='-':\r\n                num.append(i.split('$')[1])\r\n        low=int(num[0])\r\n        hign=int(num[1])\r\n        posts2 = Flower.query.filter(and_(Flower.price>=low,Flower.price<=hign)).all()\r\n        print(posts)\r\n        print(posts2)\r\n    print(posts2)\r\n    p = 'sales'\r\n    return render_template('newshop.html', posts=posts, posts2=posts2, posts3=posts,baskets=basket_in_db_list, length=basket_length,\r\n                           total=total, order=order_in_db, p=p,basketslike=basketlike_in_db_list, lengthlike=basketlike_length,postslength=len(posts),posts3length=len(posts2))\r\n\r\n@app.route('/Filter_N', methods=['GET', 'POST'])\r\ndef Filter_N():\r\n    \"\"\"flower = Flower(name=\"rose\", intro=\"DO the test\", price=100,\r\n                    number=50, img=\"signup.jfif\" ,address=\"CHINESE FOREVER ROAD\")\r\n    db.session.add(flower)\r\n    db.session.commit()\"\"\"\r\n    posts_query = Flower.query\r\n    print('yes')\r\n    print(request.values.getlist('customCheck'))\r\n    option = request.values.getlist('customCheck')\r\n    min = option[0]\r\n    max = 0\r\n    for s in option:\r\n        if int(s) > int(max):\r\n            max = int(s)\r\n        if int(s) < int(min):\r\n            min = int(s)\r\n    max = max + 10\r\n    if int(option[len(option) - 1]) != 30:\r\n        posts = posts_query.filter(and_(Flower.number >= min, Flower.number <= max)).all()\r\n    if int(option[len(option)-1]) == 30:\r\n        posts = posts_query.filter(Flower.name >= min).all()\r\n    print(max, min)\r\n    if len(option)>1:\r\n        if int(option[0]) == 0 and int(option[1]) == 20 and len(option) == 2:\r\n            posts = Flower.query.filter(or_(and_(Flower.number >= 20, Flower.number <= 30), and_(Flower.number >= 0, Flower.number <= 10))).all()\r\n        if int(option[0]) == 0 and int(option[1]) == 30 and len(option) == 2:\r\n            posts = Flower.query.filter(or_(Flower.number >= 30, and_(Flower.number >= 0, Flower.number <= 10))).all()\r\n        if int(option[0]) == 10 and int(option[1]) == 30 and len(option) == 2:\r\n            posts = Flower.query.filter(or_(Flower.number >= 30, and_(Flower.number >= 10, Flower.number <= 20))).all()\r\n        if int(option[0]) == 0 and int(option[1]) == 10 and len(option) == 3 and int(option[2] == 30):\r\n            posts = Flower.query.filter(or_(Flower.number >= 30, and_(Flower.number >= 0, Flower.number <= 20))).all()\r\n    posts2 = posts\r\n    print(posts2)\r\n    username = session.get(\"USERNAME\")\r\n    user = User.query.filter(User.username == username).first()\r\n    user_id = user.id\r\n    order_in_db = Orders.query.filter(and_(Orders.state == \"unpayment\", Orders.user_id == user_id)).first()\r\n    if order_in_db is None:\r\n        order = Orders(price=0, name=user.username, destination=\"Beijing university of technology\",\r\n                      state=\"unpayment\", number=100, way=\"deliver\", user_id=user.id)\r\n        db.session.add(order)\r\n        db.session.commit()\r\n    order_in_db = Orders.query.filter(and_(Orders.state == \"unpayment\", Orders.user_id == user_id)).first()\r\n    basket_in_db_list = Basket.query.filter(and_(Basket.order_id == order_in_db.id, Basket.user_id == user_id)).all()\r\n    basket_length = len(basket_in_db_list)\r\n    '''print(posts)'''\r\n    total = 0\r\n    want_in_db = Want.query.filter(Want.user_id == user_id).first()\r\n    basketlike_in_db_list = Basketlike.query.filter(Basketlike.want_id == want_in_db.id,\r\n                                                    Basketlike.user_id == user_id).all()\r\n    basketlike_length = len(basketlike_in_db_list)\r\n    for basket in basket_in_db_list:\r\n        total = total + basket.total*basket.quantity\r\n    content = None\r\n    content = request.form.get('amount')\r\n    if content!=None:\r\n        content1=content.split(' ')\r\n        print(content.split(' '))\r\n        num=[]\r\n        for i in content1:\r\n            if i!='' and i!='-':\r\n                num.append(i.split('$')[1])\r\n        low=int(num[0])\r\n        hign=int(num[1])\r\n        posts2 = Flower.query.filter(and_(Flower.price>=low,Flower.price<=hign)).all()\r\n        print(posts)\r\n        print(posts2)\r\n    p = 'default'\r\n    print(posts2)\r\n    return render_template('newshop.html', posts=posts, posts2=posts2, posts3=posts,baskets=basket_in_db_list, length=basket_length,\r\n                           total=total, order=order_in_db, p=p,basketslike=basketlike_in_db_list, lengthlike=basketlike_length,postslength=len(posts),posts3length=len(posts2))\r\n\r\n\r\n\r\n\r\n\r\n@app.route('/detail/<id>', methods=['GET', 'POST'])\r\ndef detail(id):\r\n    posts = Flower.query.filter().all()\r\n    flower = Flower.query.filter(Flower.id == id).first()\r\n    print(flower.id)\r\n    posts_query = Flower.query\r\n    posts = posts_query.filter().all()\r\n    posts2 = posts\r\n    posts3 = posts\r\n    username = session.get(\"USERNAME\")\r\n    users = User.query.filter(User.username == username)\r\n    user = users.first()\r\n    user_id = user.id\r\n    order_in_db = Orders.query.filter(and_(Orders.state == \"unpayment\", Orders.user_id == user_id)).first()\r\n    order_in_dbs = Orders.query.filter().all()\r\n    '''print(order_in_dbs)\r\n    print(\"---------------------------------\")'''\r\n    \"\"\"order_in_db=order_in_dbs.first()\"\"\"\r\n    want_in_db = Want.query.filter(Want.user_id == user_id).first()\r\n    if want_in_db is None:\r\n        want = Want(user_id=user.id)\r\n        db.session.add(want)\r\n        db.session.commit()\r\n    if order_in_db is None:\r\n        order = Orders(price=0, name=user.username, destination=\"Beijing university of technology\",\r\n                       state=\"unpayment\", number=100, way=\"deliver\", user_id=user.id)\r\n        db.session.add(order)\r\n        db.session.commit()\r\n        order_in_db = Orders.query.filter(and_(Orders.state == \"unpayment\", Orders.user_id == user_id)).first()\r\n    want_in_db = Want.query.filter(Want.user_id == user_id).first()\r\n    basket_in_db_list = Basket.query.filter(and_(Basket.order_id == order_in_db.id, Basket.user_id == user_id)).all()\r\n    basketlike_in_db_list = Basketlike.query.filter(Basketlike.want_id == want_in_db.id,\r\n                                                    Basketlike.user_id == user_id).all()\r\n    basket_length = len(basket_in_db_list)\r\n    basketlike_length = len(basketlike_in_db_list)\r\n    '''print(posts)'''\r\n    total = 0\r\n    for basket in basket_in_db_list:\r\n        total = total + basket.total * basket.quantity\r\n    review = Review.query.filter(Review.flower_id == flower.id).order_by(Review.timestamp.desc())\r\n    count = review.count()\r\n    reply = []\r\n    for r in review:\r\n        rr = Replyr.query.filter(Replyr.review_id == r.id).first()\r\n        reply.append(rr)\r\n    return render_template('newproduct-details.html',flower=flower,posts=posts,posts2=posts2, posts3=posts3,baskets=basket_in_db_list, length=basket_length, total=total,\r\n                           order=order_in_db,basketslike=basketlike_in_db_list, lengthlike=basketlike_length,postslength=len(posts),posts3length=len(posts3), review=review, count=count, reply=reply)\r\n\r\n@app.route('/sendreview', methods=['GET','POST'])\r\ndef sendreview():\r\n    print('makereview')\r\n    user_id = User.query.filter(User.username == session['USERNAME']).first().id\r\n    text = request.form['text']\r\n    rate = request.form['rate']\r\n    flower_id = request.form['flower_id']\r\n    review = Review(rate=rate, text=text, user_id=user_id, flower_id=flower_id, profile_id=user_id)\r\n    db.session.add(review)\r\n    db.session.commit()\r\n    return jsonify({'state': 'success'})\r\n\r\n@app.route('/checkidentity', methods=['GET','POST'])\r\ndef checkidentity():\r\n    username = session.get(\"USERNAME\")\r\n    user = User.query.filter(User.username == username).first()\r\n    return jsonify({'identity':user.identity})\r\n\r\n@app.route('/sendreply', methods=['GET','POST'])\r\ndef sendreply():\r\n    username = session.get(\"USERNAME\")\r\n    user = User.query.filter(User.username == username).first()\r\n    text = request.form['text']\r\n    review_id = request.form['review_id']\r\n    result = Replyr.query.filter(Replyr.review_id == review_id).first()\r\n    if result is None:\r\n        reply = Replyr(text=text, user_id = user.id, review_id=review_id)\r\n        db.session.add(reply)\r\n        db.session.commit()\r\n        return jsonify({'state': 'success'})\r\n    else:\r\n        return jsonify({'state': 'fail'})\r\n\r\n\r\n\r\n@app.route(\"/RemoveBasketlike\",methods=['GET', 'POST'])\r\ndef RemoveBasketlike():\r\n    if session.get(\"USERNAME\") is None:\r\n        return redirect(\"login\")\r\n    else:\r\n        username = session.get(\"USERNAME\")\r\n        user = User.query.filter(User.username == username).first()\r\n        user_id = user.id\r\n        basketlikeId = request.form['id']\r\n        print(basketlikeId)\r\n        basketlike_in_db = Basketlike.query.filter(Basketlike.id == basketlikeId).first()\r\n        db.session.delete(basketlike_in_db)\r\n        db.session.commit()\r\n        want_in_db = Want.query.filter(Want.user_id == user_id).first()\r\n        basketlike_in_db_list = Basketlike.query.filter(\r\n            and_(Basketlike.want_id == want_in_db.id, Basketlike.user_id == user_id)).all()\r\n        basketlike_length = len(basketlike_in_db_list)\r\n        return jsonify({'message': 'remove to Trolley successfully!','id': basketlikeId,'length':basketlike_length})\r\n\r\n\r\n\r\n\r\n@app.route(\"/RemoveBasket\",methods=['GET', 'POST'])\r\ndef RemoveBasket():\r\n    if session.get(\"USERNAME\") is None:\r\n        return redirect(\"login\")\r\n    else:\r\n        username = session.get(\"USERNAME\")\r\n        user = User.query.filter(User.username == username).first()\r\n        user_id = user.id\r\n        basketId = request.form['id']\r\n        print(basketId)\r\n        basket_in_db = Basket.query.filter(Basket.id == basketId).first()\r\n        db.session.delete(basket_in_db)\r\n        db.session.commit()\r\n        order_in_db = Orders.query.filter(and_(Orders.state == \"unpayment\", Orders.user_id == user_id)).first()\r\n        basket_in_db_list = Basket.query.filter(\r\n            and_(Basket.order_id == order_in_db.id, Basket.user_id == user_id)).all()\r\n        basket_length = len(basket_in_db_list)\r\n        total = 0\r\n        for basket in basket_in_db_list:\r\n            total = total + basket.total*basket.quantity\r\n        return jsonify({'message': 'remove to Trolley successfully!','id': basketId,'length':basket_length,'total':total})\r\n\r\n\r\n@app.route(\"/PaymentOrder\")\r\ndef PaymentOrder():\r\n    if session.get(\"USERNAME\") is None:\r\n        return redirect(\"login\")\r\n    else:\r\n        orderId = int(request.args.get('orderId'))\r\n        username = session.get(\"USERNAME\")\r\n        user = User.query.filter(User.username == username).first()\r\n        user_id = user.id\r\n        order_in_db = Orders.query.filter(\r\n            and_(Orders.state == \"unpayment\", Orders.user_id == user_id, Orders.id == orderId)).first()\r\n        order_in_db.state = \"Transporting\"\r\n        order_in_db.way = \"Delivery\"\r\n        db.session.commit()\r\n        order = Orders(price=0, name=user.username, destination=\"Beijing university of technology\",\r\n                      state=\"unpayment\", number=100, way=\"deliver\", user_id=user.id)\r\n        db.session.add(order)\r\n        db.session.commit()\r\n        return redirect(url_for('complete'))\r\n\r\n\r\n@app.route(\"/addToCart\",methods=['GET', 'POST'])\r\ndef addToCart():\r\n    if session.get(\"USERNAME\") is None:\r\n        return redirect(\"login\")\r\n    else:\r\n        username = session.get(\"USERNAME\")\r\n        user = User.query.filter(User.username == username).first()\r\n        user_id = user.id\r\n        orders_in_db = Orders.query.filter(and_(Orders.state == \"unpayment\", Orders.user_id == user_id)).all()\r\n        flag = 1\r\n        if orders_in_db is not None:\r\n            for order in orders_in_db:\r\n                if order.state == 'unpayment':\r\n                    flag = 0\r\n        else:\r\n            flag = 1\r\n        if flag == 1:\r\n            order = Orders(price=0, name=user.username, destination=\"Beijing university of technology\",\r\n                          state=\"unpayment\", number=100, way=\"deliver\", user_id=user.id)\r\n            db.session.add(order)\r\n            db.session.commit()\r\n        productId = request.form['id']\r\n        quantity=request.form['quantity']\r\n        flowername=request.form['name']\r\n        print(productId)\r\n        print(flowername)\r\n        if productId!='100':\r\n            flower_in_db = Flower.query.filter(Flower.id == productId).first()\r\n        else:\r\n            flower_in_db = Flower.query.filter(Flower.name == flowername).first()\r\n        orders_in_db_test=Orders.query.filter(and_(Orders.state == \"unpayment\", Orders.user_id == user_id)).first()\r\n        order_id = Orders.query.filter(and_(Orders.state == \"unpayment\", Orders.user_id == user_id)).first().id\r\n        basket = Basket(name=flower_in_db.name, quantity=quantity, total=flower_in_db.price, user_id=user_id,\r\n                        flower_id=flower_in_db.id, order_id=order_id)\r\n        basketImg = flower_in_db.img\r\n        basketQuantity=basket.quantity\r\n        basketTotal=int(basket.total)*int(quantity)\r\n        db.session.add(basket)\r\n        db.session.commit()\r\n        order_in_db = Orders.query.filter(and_(Orders.state == \"unpayment\", Orders.user_id == user_id)).first()\r\n        order_in_db.price = order_in_db.price + basket.total*basket.quantity\r\n        print(\"order_in_db.price_after:\")\r\n        print(order_in_db.price)\r\n        db.session.commit()\r\n        order_in_db = Orders.query.filter(and_(Orders.state == \"unpayment\", Orders.user_id == user_id)).first()\r\n        basket_in_db_list = Basket.query.filter(\r\n            and_(Basket.order_id == order_in_db.id, Basket.user_id == user_id)).all()\r\n        basket_length = len(basket_in_db_list)\r\n        basketId=basket_length\r\n        print(basketId)\r\n        \"\"\"order_in_db = Orders.query.filter(and_(Orders.state == \"unpayment\", Orders.user_id == user_id)).first()\r\n        print(order_in_db.price)\"\"\"\r\n        return jsonify({'message': 'Add to Trolley successfully!','length':basket_length,'id': basketId,'img':basketImg,'quantity':basketQuantity,'total':basketTotal})\r\n\r\n@app.route(\"/addToLike\",methods=['GET', 'POST'])\r\ndef addToLike():\r\n    if session.get(\"USERNAME\") is None:\r\n        return redirect(\"login\")\r\n    else:\r\n        username = session.get(\"USERNAME\")\r\n        user = User.query.filter(User.username == username).first()\r\n        user_id = user.id\r\n        wants_in_db = Want.query.filter(Orders.user_id == user_id).all()\r\n        flag = 1\r\n        if wants_in_db is not None:\r\n            flag=0\r\n        if flag == 1:\r\n            want = Want(user_id=user.id)\r\n            db.session.add(want)\r\n            db.session.commit()\r\n        productId = request.form['id']\r\n        quantity=request.form['quantity']\r\n        flowername=request.form['name']\r\n        print(productId)\r\n        print(flowername)\r\n        if productId!='100':\r\n            flower_in_db = Flower.query.filter(Flower.id == productId).first()\r\n        else:\r\n            flower_in_db = Flower.query.filter(Flower.name == flowername).first()\r\n        want_id = Want.query.filter(Want.user_id == user_id).first().id\r\n        basketlike = Basketlike(name=flower_in_db.name, user_id=user_id,\r\n                        flower_id=flower_in_db.id, want_id=want_id)\r\n        basketlikeImg = flower_in_db.img\r\n        db.session.add(basketlike)\r\n        db.session.commit()\r\n        want_in_db = Want.query.filter( Want.user_id == user_id).first()\r\n        db.session.commit()\r\n        want_in_db = Want.query.filter( Want.user_id == user_id).first()\r\n        basketlike_in_db_list = Basketlike.query.filter(\r\n            and_(Basketlike.want_id == want_in_db.id, Basketlike.user_id == user_id)).all()\r\n        basketlike_length = len(basketlike_in_db_list)\r\n        basketId=basketlike_length\r\n        print(basketId)\r\n        \"\"\"order_in_db = Orders.query.filter(and_(Orders.state == \"unpayment\", Orders.user_id == user_id)).first()\r\n        print(order_in_db.price)\"\"\"\r\n        return jsonify({'message': 'Add to Wishlist successfully!','length':basketlike_length,'id': basketId,'img':basketlikeImg})\r\n\r\n\r\n@app.route('/checkout',methods=['GET', 'POST'])\r\ndef checkout():\r\n    sessionstatue=session.get(\"COVID\")\r\n    posts_query = Flower.query\r\n    posts = posts_query.filter().all()\r\n    posts2 = posts\r\n    username = session.get(\"USERNAME\")\r\n    users = User.query.filter(User.username == username)\r\n    user = users.first()\r\n    user_id = user.id\r\n    order_in_dbs = Orders.query\r\n    print(order_in_dbs)\r\n    print(\"---------------------------------\")\r\n    order_in_db = order_in_dbs.first()\r\n    want_in_db = Want.query.filter(Want.user_id == user_id).first()\r\n    if want_in_db is None:\r\n        want = Want(user_id=user.id)\r\n        db.session.add(want)\r\n        db.session.commit()\r\n    if order_in_db is None:\r\n        order = Orders(price=0, name=user.username, destination=\"Beijing university of technology\",\r\n                      state=\"unpayment\", number=100, way=\"deliver\", user_id=user.id)\r\n        db.session.add(order)\r\n        db.session.commit()\r\n    order_in_db = Orders.query.filter(and_(Orders.state == \"unpayment\", Orders.user_id == user_id)).first()\r\n    want_in_db = Want.query.filter(Want.user_id == user_id).first()\r\n    basket_in_db_list = Basket.query.filter(and_(Basket.order_id == order_in_db.id, Basket.user_id == user_id)).all()\r\n    basketlike_in_db_list = Basketlike.query.filter(Basketlike.want_id == want_in_db.id,\r\n                                                    Basketlike.user_id == user_id).all()\r\n    basket_length = len(basket_in_db_list)\r\n    basketlike_length = len(basketlike_in_db_list)\r\n    '''print(posts)'''\r\n    total = 0\r\n    for basket in basket_in_db_list:\r\n        total = total + basket.total * basket.quantity\r\n    form = CheckoutForm()\r\n    if form.validate_on_submit():\r\n        order_in_db = Orders.query.filter(and_(Orders.state == \"unpayment\", Orders.user_id == user_id)).first()\r\n        order_in_db.way=form.delivery.value\r\n        return 0\r\n    return render_template('checkout.html', posts=posts, baskets=basket_in_db_list, length=basket_length, total=total,\r\n                           order=order_in_db, posts2=posts2,basketslike=basketlike_in_db_list, lengthlike=basketlike_length,form=form,sessionstatue=sessionstatue)\r\n\r\n\r\n@app.route('/complete')\r\ndef complete():\r\n    return render_template('complete.html')\r\n\r\n\r\n@app.route('/about_us')\r\ndef about_us():\r\n    posts_query = Flower.query\r\n    posts = posts_query.filter().all()\r\n    posts2 = posts\r\n    username = session.get(\"USERNAME\")\r\n    users = User.query.filter(User.username == username)\r\n    user = users.first()\r\n    user_id = user.id\r\n    order_in_db = Orders.query.filter(and_(Orders.state == \"unpayment\", Orders.user_id == user_id)).first()\r\n    order_in_dbs = Orders.query.filter().all()\r\n    print(order_in_dbs)\r\n    print(\"---------------------------------\")\r\n    \"\"\"order_in_db=order_in_dbs.first()\"\"\"\r\n    want_in_db = Want.query.filter(Want.user_id == user_id).first()\r\n    if want_in_db is None:\r\n        want = Want(user_id=user.id)\r\n        db.session.add(want)\r\n        db.session.commit()\r\n    if order_in_db is None:\r\n        order = Orders(price=0, name=user.username, destination=\"Beijing university of technology\",\r\n                       state=\"unpayment\", number=100, way=\"deliver\", user_id=user.id)\r\n        db.session.add(order)\r\n        db.session.commit()\r\n        order_in_db = Orders.query.filter(and_(Orders.state == \"unpayment\", Orders.user_id == user_id)).first()\r\n    want_in_db = Want.query.filter(Want.user_id == user_id).first()\r\n    basket_in_db_list = Basket.query.filter(and_(Basket.order_id == order_in_db.id, Basket.user_id == user_id)).all()\r\n    basketlike_in_db_list = Basketlike.query.filter(Basketlike.want_id == want_in_db.id,\r\n                                                    Basketlike.user_id == user_id).all()\r\n    basket_length = len(basket_in_db_list)\r\n    basketlike_length = len(basketlike_in_db_list)\r\n    total = 0\r\n    for basket in basket_in_db_list:\r\n        total = total + basket.total * basket.quantity\r\n    return render_template('newabout_us.html', posts=posts, baskets=basket_in_db_list, length=basket_length, total=total,\r\n                           order=order_in_db, posts2=posts2,basketslike=basketlike_in_db_list, lengthlike=basketlike_length)\r\n\r\n\r\n@app.route('/logout')\r\ndef logout():\r\n    if session['USERNAME'] is None:\r\n        return redirect(url_for('signup'))\r\n    session.pop(\"USERNAME\", None)\r\n    return redirect(url_for('signup'))\r\n\r\n\r\n@app.route('/addflower', methods=['GET', 'POST'])\r\ndef addflower():\r\n    form = FlowerForm()\r\n    if session.get(\"USERNAME\") is None:\r\n        flash(\"Please login first\")\r\n        return redirect(\"login\")\r\n    else:\r\n        username = session.get(\"USERNAME\")\r\n        users = User.query.filter(User.username == username)\r\n        user = users.first()\r\n        if user.identity=='customer':\r\n            flash(\"As a customer,you can not access this page.\")\r\n            return redirect(\"login\")\r\n        if form.validate_on_submit():\r\n            name = form.name.data\r\n            img_dir = config.Config.PC_UPLOAD_DIR\r\n            print(img_dir)\r\n            imgs_obj = form.image.data\r\n            i=0\r\n            img1=\"\"\r\n            for img_obj in imgs_obj:\r\n                if i==0:\r\n                    img_filename = session.get(\"USERNAME\") + name + str(i)+'_img.jpg'\r\n                    img_obj.save(os.path.join(img_dir, img_filename))\r\n                else:\r\n                    img1=session.get(\"USERNAME\") + name + str(i)+'_img.jpg'\r\n                    img_obj.save(os.path.join(img_dir, img1))\r\n                i=i+1\r\n            flower = Flower(name=form.name.data, intro=form.detail.data, price=form.price.data, number=form.number.data,\r\n                            img=img_filename, img1=img1,address=form.address.data)\r\n            print(\"caocaocao3\")\r\n            db.session.add(flower)\r\n            db.session.commit()\r\n            flash(\"'Add flower successfully!\")\r\n            return redirect(url_for('index'))\r\n        else:\r\n            return render_template('addFlowers.html', title='add flowers', form=form)\r\n\r\n\r\n@app.route('/checkusername', methods=['POST'])\r\ndef check_username():\r\n    chosen_name = request.form['username']\r\n    user_in_db = User.query.filter(User.username == chosen_name).first()\r\n    if not user_in_db:\r\n        return jsonify({'text': 'Username is available',\r\n                        'returnvalue': 0})\r\n    else:\r\n        return jsonify({'text': 'Username is already taken',\r\n                        'returnvalue': 1})\r\n\r\n\r\n@app.route('/checkemail', methods=['POST'])\r\ndef check_email():\r\n    chosen_email = request.form['email']\r\n    user_in_db = User.query.filter(User.email == chosen_email).first()\r\n    if not user_in_db:\r\n        return jsonify({'text': 'This Email is available',\r\n                        'returnvalue': 0})\r\n    else:\r\n        return jsonify({'text': 'This Email is already taken',\r\n                        'returnvalue': 1})\r\n\r\n\r\n@app.route('/OrderDisplay', methods=['GET', 'POST'])\r\ndef OrderDisplay():\r\n    if session.get(\"USERNAME\") is None:\r\n        flash(\"Please login first\")\r\n        return redirect(\"login\")\r\n    username = session.get(\"USERNAME\")\r\n    users = User.query.filter(User.username == username)\r\n    user = users.first()\r\n    if user.identity=='customer':\r\n        flash(\"As a customer,you can not access this page.\")\r\n        return redirect(\"login\")\r\n    orders = Orders.query.all()\r\n    order = Orders.query.filter(Orders.id == 1)\r\n    return render_template('OrderDisplay.html', title='Order Display', orders=orders, order=order)\r\n\r\n\r\n@app.route('/OrderDetail/<order_id>', methods=['GET', 'POST'])\r\ndef OrderDetail(order_id):\r\n    order = Orders.query.filter(Orders.id == order_id).first()\r\n    user = User.query.filter(User.id == order.user_id).first()\r\n    orders = Orders.query.filter(Orders.user_id == user.id)\r\n    flowers = Flower.query.all()\r\n    baskets = Basket.query.filter(Basket.order_id == order_id)\r\n    total = 0\r\n    for basket in baskets:\r\n        total = total + basket.total\r\n    return render_template('OrderDetail.html', title='Order Display', order=order, flowers=flowers, orders=orders,\r\n                           total=total, baskets=baskets)\r\n\r\n@app.route('/Modify/<flower_id>', methods=['GET', 'POST'])\r\ndef Modify(flower_id):\r\n    flower = Flower.query.filter(Flower.id == flower_id).first()\r\n    flowers = Flower.query.all()\r\n    if request.method == 'POST':\r\n        if request.values.get('t'):\r\n            print(request.values.get('t'))\r\n            print(request.values.get('price'))\r\n            # file_obj = request.files.get('photos')\r\n            # print(file_obj)\r\n            img_dir = config.Config.PC_UPLOAD_DIR\r\n            # print(img_dir)\r\n            # img_filename = '1'\r\n            # print(os.path.join(img_dir, img_filename))\r\n\r\n            # print(secure_filename(file_obj.filename))\r\n            flower.name = request.values.get('name')\r\n            flower.intro = request.values.get('detail')\r\n            flower.price = request.values.get('price')\r\n            if request.files.get(\"photos\") != 'null':\r\n                file_obj = request.files.get('photos')\r\n                file_name = secure_filename(file_obj.filename)\r\n                file_obj.save(os.path.join(img_dir, file_name))\r\n                flower.img = file_name\r\n            flower.number = request.values.get('avail')\r\n            db.session.commit()\r\n            return redirect(url_for('Flowers'))\r\n    if request.method == 'GET':\r\n        print(request.method)\r\n        return redirect(url_for('Flowers'))\r\n\r\n@app.route('/ModifyFlower/<flower_id>', methods=['GET', 'POST'])\r\ndef ModFlower(flower_id):\r\n    flower = Flower.query.filter(Flower.id == flower_id).first()\r\n    return render_template('ModifyFlower.html', title='FlowersChange', flower=flower)\r\n\r\n\r\n@app.route('/FlowerGallery', methods=['GET', 'POST'])\r\ndef Flowers():\r\n    if session.get(\"USERNAME\") is None:\r\n        flash(\"Please login first\")\r\n        return redirect(\"login\")\r\n    username = session.get(\"USERNAME\")\r\n    users = User.query.filter(User.username == username)\r\n    user = users.first()\r\n    if user.identity=='customer':\r\n        flash(\"As a customer,you can not access this page.\")\r\n        return redirect(\"login\")\r\n    flowers = Flower.query.all()\r\n    return render_template('FlowerGallery.html', title='Flowers', flowers=flowers)\r\n\r\n@app.route('/Charts', methods=['GET', 'POST'])\r\ndef Charts():\r\n    if session.get(\"USERNAME\") is None:\r\n        flash(\"Please login first\")\r\n        return redirect(\"login\")\r\n    username = session.get(\"USERNAME\")\r\n    users = User.query.filter(User.username == username)\r\n    user = users.first()\r\n    if user.identity=='customer':\r\n        flash(\"As a customer,you can not access this page.\")\r\n        return redirect(\"login\")\r\n    dbEngine= db.get_engine();\r\n    # print(dbEngine)\r\n    ts = pd.read_sql('select timestamp,price from orders',dbEngine)\r\n\r\n    ts=ts.set_index('timestamp')\r\n\r\n    index = list(ts.index)\r\n    index.append(datetime.now())\r\n\r\n    index=pd.to_datetime(index)\r\n    price=list(ts['price'].values)\r\n\r\n    price.append(0.0)\r\n    obj = pd.Series(price, index=index)\r\n    obj = obj.resample('D').sum()\r\n    obj = obj[-30:]\r\n\r\n    revenue = obj.sum()\r\n    print(revenue)\r\n\r\n    index = list(obj.index)\r\n    price = list(obj.values)\r\n\r\n    xaxis = []\r\n\r\n    for i in index:\r\n        xaxis.append(str(i)[5:10])\r\n\r\n    # print(xaxis)\r\n    # print(price)\r\n\r\n    fig = plt.figure(figsize=(20, 6))\r\n    plt.style.use('ggplot')\r\n    ax = fig.add_subplot(1, 1, 1)\r\n    \"\"\"lab = ax.set_xticklabels(labels=xaxis, rotation=40, fontsize='xx-large')\"\"\"\r\n    \"\"\"ax.set_title('Revenue In Last Month')\r\n    plt.plot(xaxis, price, 'go--')\r\n    # plt.show()\r\n    fig.savefig(r'./newsapp/static/images/Revenue.png')\"\"\"\r\n    # print('save le')\r\n\r\n    OrderF=1\r\n    OrderT=2\r\n    Regis=3\r\n\r\n\r\n\r\n    return render_template('Charts.html',revenue=revenue,OrderF=OrderF,OrderT=OrderT,Regis=Regis)\r\n\r\n\r\n\r\n@app.route('/ChatRoom', methods=['GET', 'POST'])\r\ndef ChatRoom():\r\n    staff = User.query.filter(User.username == session['USERNAME']).first().id  # 自己的id\r\n    img = Profile.query.filter(Profile.user_id == staff).first().portrait     # 头像\r\n    # 获取历史聊天用户和新消息数量\r\n    new = News.query.filter(News.receiver_id == staff).order_by(News.number.desc())\r\n    return render_template('ChatRoom.html', title='ChatRoom', news=new, img=img)\r\n\r\n\r\n@app.route('/onlinechat', methods=['GET','POST'])\r\ndef onlinechat():\r\n    user = User.query.filter(User.username == session['USERNAME']).first().id  # 自己的id\r\n    img = Profile.query.filter(Profile.user_id == user).first().portrait  # 头像\r\n    # 获取历史聊天用户和新消息数量\r\n    new = News.query.filter(News.receiver_id == user).order_by(News.number.desc())\r\n    posts_query = Flower.query\r\n    user_id = user\r\n    order_in_db = Orders.query.filter(and_(Orders.state == \"unpayment\", Orders.user_id == user_id)).first()\r\n    posts = posts_query.filter().all()\r\n    want_in_db = Want.query.filter(Want.user_id == user_id).first()\r\n    basket_in_db_list = Basket.query.filter(and_(Basket.order_id == order_in_db.id, Basket.user_id == user_id)).all()\r\n    basketlike_in_db_list = Basketlike.query.filter(Basketlike.want_id == want_in_db.id,\r\n                                                    Basketlike.user_id == user_id).all()\r\n    basket_length = len(basket_in_db_list)\r\n    basketlike_length = len(basketlike_in_db_list)\r\n    '''print(posts)'''\r\n    total = 0\r\n    for basket in basket_in_db_list:\r\n        total = total + basket.total * basket.quantity\r\n    return render_template('onlinechat.html', title='ChatRoom', news=new, img=img,posts=posts, baskets=basket_in_db_list, length=basket_length, total=total,order=order_in_db,basketslike=basketlike_in_db_list, lengthlike=basketlike_length)\r\n\r\n\r\n@app.route('/shownews', methods=['GET', 'POST'])\r\ndef shownews():\r\n    id1 = User.query.filter(User.username == session['USERNAME']).first().id  # 自己的id\r\n    id2 = request.form['user_id']  # 顾客的id\r\n    print(id1)\r\n    print(id2)\r\n    user_news = News.query.filter(and_(News.sender_id == id2, News.receiver_id == id1)).first()\r\n    user_news.number = 0  # 未读消息归0\r\n    db.session.commit()\r\n    message = Message.query.filter(or_((and_(Message.sender_id == id1, Message.receiver_id == id2)),\r\n                                       (and_(Message.sender_id == id2, Message.receiver_id == id1)))).order_by(\r\n        Message.timestamp)  # 聊天记录和新消息\r\n    print(message.count())\r\n    news = []\r\n    # 转化为字典list\r\n    for new in message:\r\n        news.append(new.to_json())\r\n    print(len(news))\r\n    return jsonify(news)\r\n\r\n\r\n@app.route('/sendnew', methods=['POST'])\r\ndef sendnew():\r\n    receiver_id = request.form['receiver_id'] # 接受者\r\n    text = request.form['text']     # 消息\r\n    user_id = User.query.filter(User.username == session['USERNAME']).first().id # 发送者\r\n    message = Message(text=text, sender_id=user_id, receiver_id=receiver_id, state='read') # 写入新消息\r\n    news = News.query.filter(and_(News.sender_id == user_id, News.receiver_id == receiver_id)).first()    # 查找新消息数量的记录\r\n    print(user_id)\r\n    profile_id = Profile.query.filter(Profile.user_id == user_id).first().id      # 发送者资料的id\r\n    if not news:\r\n        news = News(number=1, sender_id=user_id, receiver_id=receiver_id, profile_id=profile_id)\r\n        db.session.add(news)\r\n    else:\r\n        news.number = news.number+1               # 新消息加一\r\n    db.session.add(message)\r\n    db.session.commit()\r\n    return jsonify({'state': 'yes'})\r\n\r\n\r\n@app.route('/current_user', methods=['GET', 'POST'])\r\ndef current_user():\r\n    user_id = User.query.filter(User.username == session['USERNAME']).first().id\r\n    return jsonify({'id': user_id})\r\n@app.route('/Delete/<flower_id>', methods=['GET', 'POST'])\r\ndef Delete(flower_id):\r\n    flower = Flower.query.filter(Flower.id == flower_id).first()\r\n    flowers = Flower.query.all()\r\n    if request.method == 'POST':\r\n        if request.values.get('d'):\r\n            print(request.values.get('d'))\r\n            db.session.delete(flower)\r\n            db.session.commit()\r\n            return render_template('FlowerGallery.html', title='Flowers', flowers=flowers)\r\n    return render_template('FlowerGallery.html', title='Flowers', flowers=flowers)\r\n\r\n\r\n@app.route('/profile', methods=['GET', 'POST'])\r\ndef profile():\r\n    if session.get(\"USERNAME\") is None:\r\n        return redirect(\"login\")\r\n    else:\r\n        username = session.get(\"USERNAME\")\r\n        user = User.query.filter(User.username == username).first()\r\n        user_id = user.id\r\n        orders_in_db = Orders.query.filter(Orders.user_id == user_id).all()\r\n        flag = 1\r\n        if orders_in_db is not None:\r\n            for order in orders_in_db:\r\n                if order.state == 'unpayment':\r\n                    flag = 0\r\n        else:\r\n            flag = 1\r\n        if flag == 1:\r\n            order = Orders(price=0, name=user.username, destination=\"Beijing university of technology\",\r\n                          state=\"unpayment\", number=100, way=\"deliver\", user_id=user.id)\r\n            db.session.add(order)\r\n            db.session.commit()\r\n            orders_in_db = Orders.query.filter(Orders.user_id == user_id).all()\r\n        order_in_db = Orders.query.filter(and_(Orders.state == \"unpayment\", Orders.user_id == user_id)).first()\r\n        want_in_db = Want.query.filter(Want.user_id == user_id).first()\r\n        basket_in_db_list = Basket.query.filter(\r\n            and_(Basket.order_id == order_in_db.id, Basket.user_id == user_id)).all()\r\n        basketlike_in_db_list = Basketlike.query.filter(Basketlike.want_id == want_in_db.id,\r\n                                                        Basketlike.user_id == user_id).all()\r\n        basket_length = len(basket_in_db_list)\r\n        basketlike_length = len(basketlike_in_db_list)\r\n        posts_query = Flower.query\r\n        posts = posts_query.filter().all()\r\n        '''print(posts)'''\r\n        total = 0\r\n        for basket in basket_in_db_list:\r\n            total = total + basket.total * basket.quantity\r\n        form = ChangePasswordForm()\r\n        if form.validate_on_submit():\r\n            user = User.query.filter(User.username == username).first()\r\n            if not check_password_hash(user.password_hash, form.passwordold.data):\r\n                flash('Wrong Password')\r\n                return redirect(url_for('profile'))\r\n            if form.password.data != form.password2.data:\r\n                flash('Passwords do not match!')\r\n                return redirect(url_for('profile'))\r\n            passw_hash = generate_password_hash(form.password.data)\r\n            user = User.query.filter(User.username == username).first()\r\n            user.password_hash=passw_hash\r\n            db.session.commit()\r\n            print(\"change password successfully\")\r\n            return redirect('index')\r\n\r\n    return render_template('profile.html',username=username,orders=orders_in_db,form=form, baskets=basket_in_db_list, length=basket_length, total=total,\r\n                           order=order_in_db, basketslike=basketlike_in_db_list, lengthlike=basketlike_length,posts=posts)\r\n\r\n@app.route('/ModifyOrder/<order_id>', methods=['GET', 'POST'])\r\ndef ModifyOrder(order_id):\r\n    order = Orders.query.filter(Orders.id == order_id).first()\r\n    baskets = Basket.query.filter(Basket.order_id == order_id).all()\r\n    flowers = Flower.query.all()\r\n    return render_template('ModifyOrders.html', title='ModifyOrder', order=order, baskets=baskets,flowers=flowers)\r\n\r\n\r\n@app.route('/Order_state_C/<order_id>', methods=['GET', 'POST'])\r\ndef Order_state_C(order_id):\r\n    order = Orders.query.filter(Orders.id == order_id).first()\r\n    order.state = 'Completed'\r\n    db.session.commit()\r\n    return redirect(url_for('ModifyOrder', order_id=order.id))\r\n\r\n\r\n@app.route('/Order_state_T/<order_id>', methods=['GET', 'POST'])\r\ndef Order_state_T(order_id):\r\n    order = Orders.query.filter(Orders.id == order_id).first()\r\n    order.state = 'Transporting'\r\n    db.session.commit()\r\n    return redirect(url_for('ModifyOrder', order_id=order.id))\r\n\r\n\r\n@app.route('/Order_state_L/<order_id>', methods=['GET', 'POST'])\r\ndef Order_state_L(order_id):\r\n    order = Orders.query.filter(Orders.id == order_id).first()\r\n    order.state = 'Lated'\r\n    db.session.commit()\r\n    return redirect(url_for('ModifyOrder', order_id=order.id))\r\n\r\n\r\n@app.route('/Order_Delete/<order_id>', methods=['GET', 'POST'])\r\ndef Order_Delete(order_id):\r\n    order = Orders.query.filter(Orders.id == order_id).first()\r\n    orders = Orders.query.all()\r\n    if request.method == \"POST\":\r\n        if request.values.get('d'):\r\n            db.session.delete(order)\r\n            db.session.commit()\r\n            return redirect(url_for('OrderDisplay'))\r\n        return redirect(url_for('OrderDisplay'))\r\n    return redirect(url_for('OrderDisplay'))\r\n\r\n\r\n@app.route('/Change_Address/<order_id>', methods=['GET', 'POST'])\r\ndef Change_Address(order_id):\r\n    order = Orders.query.filter(Orders.id == order_id).first()\r\n    print(request.values.get('text'))\r\n    print(request.values.get('c'))\r\n    if request.method == 'POST':\r\n        if request.values.get('c'):\r\n            order.destination = request.values.get('text')\r\n            db.session.commit()\r\n            return redirect(url_for('ModifyOrder', order_id=order.id))\r\n    if request.method == 'GET':\r\n        print(request.method)\r\n        return redirect(url_for('ModifyOrder', order_id=order.id))\r\n\r\n\r\n@app.route('/COVID/', methods=['GET', 'POST'])\r\ndef COVID():\r\n    c = 0\r\n    if session['COVID'] == 'True':\r\n        c = 1\r\n        return render_template('COVID.html', title='COVID-19 Model', c=c)\r\n    elif session['COVID'] == 'False':\r\n        return render_template('COVID.html', title='COVID-19 Model', c=c)\r\n\r\n\r\n@app.route('/COVID_Change/', methods=['GET', 'POST'])\r\ndef COVID_Change():\r\n    if session['COVID'] == 'False':\r\n        session['COVID'] = 'True'\r\n    elif session['COVID'] == 'True':\r\n        session['COVID'] = 'False'\r\n    return redirect(url_for('COVID'))
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/newsapp/routes.py b/newsapp/routes.py
--- a/newsapp/routes.py	(revision cd272d0a83316b4d9bc5b4c8524ccdd7ef6890fd)
+++ b/newsapp/routes.py	(date 1622124184543)
@@ -14,7 +14,7 @@
 from newsapp import app, db, config
 from newsapp.forms import LoginForm, SignupForm, FlowerForm, ChangePasswordForm, CheckoutForm
 from newsapp.models import Flower, Orders, Basket, Message, Profile, News, Review, Want, Basketlike, Replyr
-from newsapp.models import User
+from newsapp.models import User, COVID19
 
 from flask_babel import Babel, gettext as _
 # from flask_babel import Babel
@@ -99,6 +99,11 @@
     form = LoginForm()
     if form.validate_on_submit():
         user = User.query.filter(User.username == form.username.data).first()
+        covid = COVID19.query.filter(COVID19.id == 1).first()
+        if covid is None:
+            new_covid = COVID19(stage='False')
+            db.session.add(new_covid)
+            db.session.commit()
         if user is None:
             flash("Please Register or Retry With a Valid Username")
             return redirect(url_for('login'))
@@ -123,6 +128,11 @@
     form = LoginForm()
     if form.validate_on_submit():
         user = User.query.filter(User.username == form.username.data).first()
+        covid = COVID19.query.filter(COVID19.id == 1).first()
+        if covid is None:
+            new_covid = COVID19(stage='False')
+            db.session.add(new_covid)
+            db.session.commit()
         if user is None:
             flash("请用有效的用户名注册或重试")
             return redirect(url_for('loginch'))
@@ -157,7 +167,8 @@
     posts = posts_query.filter().all()
     posts2 = posts
     username = session.get("USERNAME")
-    sessionstatue=session.get("COVID")
+    covid = COVID19.query.filter(COVID19.id == 1).first()
+    sessionstatue=covid.stage
     print(sessionstatue)
     users = User.query.filter(User.username == username)
     user=users.first()
@@ -618,7 +629,7 @@
 @app.route('/sendreview', methods=['GET','POST'])
 def sendreview():
     print('makereview')
-    user_id = User.query.filter(User.username == session['USERNAME']).first().id
+    user_id = User.query.filter(User.username == session['USERNAME']).first().idf
     text = request.form['text']
     rate = request.form['rate']
     flower_id = request.form['flower_id']
@@ -816,7 +827,8 @@
 
 @app.route('/checkout',methods=['GET', 'POST'])
 def checkout():
-    sessionstatue=session.get("COVID")
+    covid = COVID19.query.filter(COVID19.id == 1).first()
+    sessionstatue = covid.stage
     posts_query = Flower.query
     posts = posts_query.filter().all()
     posts2 = posts
@@ -1321,17 +1333,21 @@
 @app.route('/COVID/', methods=['GET', 'POST'])
 def COVID():
     c = 0
-    if session['COVID'] == 'True':
+    covid = COVID19.query.filter(COVID19.id == 1).first()
+    if covid.stage == 'True':
         c = 1
         return render_template('COVID.html', title='COVID-19 Model', c=c)
-    elif session['COVID'] == 'False':
+    elif covid.stage == 'False':
         return render_template('COVID.html', title='COVID-19 Model', c=c)
 
 
 @app.route('/COVID_Change/', methods=['GET', 'POST'])
 def COVID_Change():
-    if session['COVID'] == 'False':
-        session['COVID'] = 'True'
-    elif session['COVID'] == 'True':
-        session['COVID'] = 'False'
+    covid = COVID19.query.filter(COVID19.id == 1).first()
+    if covid.stage == 'False':
+        covid.stage = 'True'
+        db.session.commit()
+    elif covid.stage == 'True':
+        covid.stage = 'False'
+        db.session.commit()
     return redirect(url_for('COVID'))
\ No newline at end of file
Index: newsapp/models.py
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>import datetime\r\n\r\nfrom sqlalchemy.orm import backref\r\n\r\nfrom newsapp import db\r\n\r\n\r\nclass User(db.Model):\r\n    id = db.Column(db.Integer, primary_key=True)\r\n    username = db.Column(db.String(64), index=True, unique=True)\r\n    email = db.Column(db.String(120), index=True, unique=True)\r\n    identity = db.Column(db.String(8))\r\n    password_hash = db.Column(db.String(128))\r\n    orders = db.relationship('Orders', backref='owner', lazy='dynamic')\r\n    basket = db.relationship('Basket', backref='user_basket', lazy='dynamic')\r\n    basketlike = db.relationship('Basketlike', backref='user_basketlike1', lazy='dynamic')\r\n    want = db.relationship('Want', backref='user_want', lazy='dynamic')\r\n    sender = db.relationship('Message', backref='sender', lazy='dynamic')\r\n    news = db.relationship('News', backref='user', lazy='dynamic')\r\n    profile = db.relationship('Profile', backref='profile', lazy='dynamic')\r\n    review = db.relationship('Review', backref='user', lazy='dynamic')\r\n\r\n    def __repr__(self):\r\n        return '<User {}>'.format(self.username)\r\n\r\n\r\nclass Staff(db.Model):\r\n    id = db.Column(db.Integer, primary_key=True)\r\n    staffname = db.Column(db.String(64), index=True, unique=True)\r\n    email = db.Column(db.String(120), index=True, unique=True)\r\n    identity = db.Column(db.String(8))\r\n    password_hash = db.Column(db.String(128))\r\n\r\n    def __repr__(self):\r\n        return '<Staff {}>'.format(self.staffname)\r\n\r\n\r\nclass Flower(db.Model):\r\n    id = db.Column(db.Integer, primary_key=True)\r\n    name = db.Column(db.String(64), index=True)\r\n    intro = db.Column(db.String(1000))\r\n    price = db.Column(db.Float)\r\n    number = db.Column(db.Integer)\r\n    img = db.Column(db.String(256))\r\n    img1 = db.Column(db.String(256))\r\n    address = db.Column(db.String(256))\r\n    basket = db.relationship('Basket', backref='flower_basket', lazy='dynamic')  # 货物\r\n    basketlike = db.relationship('Basketlike', backref='flower_basketlike', lazy='dynamic')  # 货物\"\"\"\r\n\r\n# 我想要\r\nclass Want(db.Model):\r\n    id = db.Column(db.Integer, primary_key=True)\r\n    user_id = db.Column(db.Integer, db.ForeignKey('user.id'))\r\n    basketlike = db.relationship('Basketlike', backref='flower_basketlike2', lazy='dynamic')  # 货物\r\n\r\nclass Orders(db.Model):\r\n    id = db.Column(db.Integer, primary_key=True)\r\n    timestamp = db.Column(db.DateTime, default=datetime.datetime.utcnow())\r\n    price = db.Column(db.Float)  # 总价\r\n    name = db.Column(db.String(64))  # 买家姓名\r\n    destination = db.Column(db.String(256))  # 买家地址\r\n    state = db.Column(db.String(64))  # 订单状态\r\n    number = db.Column(db.Integer)  # 数量\r\n    way = db.Column(db.String(16))  # 提货方式，快递或者自提\r\n    user_id = db.Column(db.Integer, db.ForeignKey('user.id'))\r\n    basket = db.relationship('Basket', backref='order_basket', lazy='dynamic')\r\n\r\n\r\n# 购物车\r\nclass Basket(db.Model):\r\n    id = db.Column(db.Integer, primary_key=True)\r\n    name = db.Column(db.String(120), index=True)  # 鲜花名字\r\n    quantity = db.Column(db.Integer, index=True)  # 数量\r\n    total = db.Column(db.Integer, index=True)  # 总价\r\n    user_id = db.Column(db.Integer, db.ForeignKey('user.id'))\r\n    flower_id = db.Column(db.Integer, db.ForeignKey('flower.id'))  # 鲜花id\r\n    order_id = db.Column(db.Integer, db.ForeignKey('orders.id'))\r\n\r\n# 喜欢单品\r\nclass Basketlike(db.Model):\r\n    id = db.Column(db.Integer, primary_key=True)\r\n    name = db.Column(db.String(120), index=True)  # 鲜花名字\r\n    user_id = db.Column(db.Integer, db.ForeignKey('user.id'))\r\n    flower_id = db.Column(db.Integer, db.ForeignKey('flower.id'))  # 鲜花id\r\n    want_id = db.Column(db.Integer, db.ForeignKey('want.id'))\r\n\r\n# 资料\r\nclass Profile(db.Model):\r\n    id = db.Column(db.Integer, primary_key=True)\r\n    name = db.Column(db.String(20))\r\n    dob = db.Column(db.String(30))\r\n    gender = db.Column(db.Integer)\r\n    description = db.Column(db.String(250))\r\n    portrait = db.Column(db.String(50))\r\n    user_id = db.Column(db.Integer, db.ForeignKey('user.id'))\r\n    news_id = db.relationship('News', backref='profile', lazy='dynamic')\r\n    review_id = db.relationship('Review', backref='profile', lazy='dynamic')\r\n\r\n\r\n# 留言消息\r\nclass Message(db.Model):\r\n    id = db.Column(db.Integer, primary_key=True)\r\n    text = db.Column(db.String(500))  # 消息\r\n    timestamp = db.Column(db.DateTime, default=datetime.datetime.now)  # 时间\r\n    state = db.Column(db.String(10))  # 状态，未读或已读\r\n    sender_id = db.Column(db.Integer, db.ForeignKey('user.id'))  # 发送\r\n    receiver_id = db.Column(db.Integer)  # 接收\r\n\r\n    # 用于将queryset转化为字典，用json传输到前台\r\n    def to_json(self):\r\n        dict = self.__dict__\r\n        if \"_sa_instance_state\" in dict:\r\n            del dict[\"_sa_instance_state\"]\r\n        return dict\r\n\r\n# 新消息数量\r\n# 顾客每发一条消息，数量加一，客服阅读后归0\r\nclass News(db.Model):\r\n    id = db.Column(db.Integer, primary_key=True)\r\n    number = db.Column(db.Integer, default=0)\r\n    sender_id = db.Column(db.Integer, db.ForeignKey('user.id'))\r\n    receiver_id = db.Column(db.Integer)\r\n    profile_id = db.Column(db.Integer, db.ForeignKey('profile.id'))\r\n\r\n# 商品评论\r\nclass Review(db.Model):\r\n    id = db.Column(db.Integer, primary_key=True)\r\n    rate = db.Column(db.Integer, default=0)    # 等级\r\n    text = db.Column(db.String(250))    # 评论\r\n    timestamp = db.Column(db.DateTime, default=datetime.datetime.now)  # 创建时间\r\n    user_id = db.Column(db.Integer, db.ForeignKey('user.id'))\r\n    profile_id = db.Column(db.Integer, db.ForeignKey('profile.id'))\r\n    flower_id = db.Column(db.Integer)\r\n\r\n# 评论回复\r\nclass Replyr(db.Model):\r\n    id = db.Column(db.Integer, primary_key=True)\r\n    user_id = db.Column(db.Integer)\r\n    text = db.Column(db.String(250))\r\n    review_id = db.Column(db.Integer)\r\n\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/newsapp/models.py b/newsapp/models.py
--- a/newsapp/models.py	(revision cd272d0a83316b4d9bc5b4c8524ccdd7ef6890fd)
+++ b/newsapp/models.py	(date 1622119300840)
@@ -139,3 +139,7 @@
     text = db.Column(db.String(250))
     review_id = db.Column(db.Integer)
 
+
+class COVID19(db.Model):
+    id = db.Column(db.Integer, primary_key=True)
+    stage = db.Column(db.String(50))
\ No newline at end of file
Index: .idea/workspace.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<project version=\"4\">\r\n  <component name=\"AutoImportSettings\">\r\n    <option name=\"autoReloadType\" value=\"SELECTIVE\" />\r\n  </component>\r\n  <component name=\"ChangeListManager\">\r\n    <list default=\"true\" id=\"a1e85ceb-f8b8-4f7a-a03d-aeda75464efe\" name=\"Default Changelist\" comment=\"Merge remote-tracking branch 'origin/y5.27' into main&#10;&#10;# Conflicts:&#10;#&#9;newsapp/__pycache__/forms.cpython-38.pyc&#10;#&#9;newsapp/__pycache__/routes.cpython-38.pyc&#10;#&#9;newsapp/newsdb.db\">\r\n      <change beforePath=\"$PROJECT_DIR$/.idea/workspace.xml\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/.idea/workspace.xml\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/app.py\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/app.py\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/newsapp/models.py\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/newsapp/models.py\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/newsapp/newsdb.db\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/newsapp/newsdb.db\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/newsapp/routes.py\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/newsapp/routes.py\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/newsapp/static/css/style.css\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/newsapp/static/css/style.css\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/newsapp/static/scripts/review.js\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/newsapp/static/scripts/review.js\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/newsapp/templates/newproduct-details.html\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/newsapp/templates/newproduct-details.html\" afterDir=\"false\" />\r\n    </list>\r\n    <option name=\"SHOW_DIALOG\" value=\"false\" />\r\n    <option name=\"HIGHLIGHT_CONFLICTS\" value=\"true\" />\r\n    <option name=\"HIGHLIGHT_NON_ACTIVE_CHANGELIST\" value=\"false\" />\r\n    <option name=\"LAST_RESOLUTION\" value=\"IGNORE\" />\r\n  </component>\r\n  <component name=\"FileTemplateManagerImpl\">\r\n    <option name=\"RECENT_TEMPLATES\">\r\n      <list>\r\n        <option value=\"Flask Main\" />\r\n        <option value=\"CSS File\" />\r\n        <option value=\"JavaScript File\" />\r\n        <option value=\"HTML File\" />\r\n      </list>\r\n    </option>\r\n  </component>\r\n  <component name=\"FlaskConsoleOptions\" custom-start-script=\"import sys&#10;sys.path.extend([WORKING_DIR_AND_PYTHON_PATHS])&#10;from flask.cli import ScriptInfo&#10;locals().update(ScriptInfo(create_app=None).load_app().make_shell_context())&#10;print(&quot;Python %s on %s\\nApp: %s [%s]\\nInstance: %s&quot; % (sys.version, sys.platform, app.import_name, app.env, app.instance_path))\">\r\n    <envs>\r\n      <env key=\"FLASK_APP\" value=\"app\" />\r\n    </envs>\r\n    <option name=\"myCustomStartScript\" value=\"import sys&#10;sys.path.extend([WORKING_DIR_AND_PYTHON_PATHS])&#10;from flask.cli import ScriptInfo&#10;locals().update(ScriptInfo(create_app=None).load_app().make_shell_context())&#10;print(&quot;Python %s on %s\\nApp: %s [%s]\\nInstance: %s&quot; % (sys.version, sys.platform, app.import_name, app.env, app.instance_path))\" />\r\n    <option name=\"myEnvs\">\r\n      <map>\r\n        <entry key=\"FLASK_APP\" value=\"app\" />\r\n      </map>\r\n    </option>\r\n  </component>\r\n  <component name=\"Git.Settings\">\r\n    <option name=\"RECENT_GIT_ROOT_PATH\" value=\"$PROJECT_DIR$\" />\r\n    <option name=\"RESET_MODE\" value=\"HARD\" />\r\n  </component>\r\n  <component name=\"GitSEFilterConfiguration\">\r\n    <file-type-list>\r\n      <filtered-out-file-type name=\"LOCAL_BRANCH\" />\r\n      <filtered-out-file-type name=\"REMOTE_BRANCH\" />\r\n      <filtered-out-file-type name=\"TAG\" />\r\n      <filtered-out-file-type name=\"COMMIT_BY_MESSAGE\" />\r\n    </file-type-list>\r\n  </component>\r\n  <component name=\"HighlightingSettingsPerFile\">\r\n    <setting file=\"file://$PROJECT_DIR$/newsapp/templates/newindex.html\" root0=\"FORCE_HIGHLIGHTING\" />\r\n    <setting file=\"file://$PROJECT_DIR$/newsapp/static/scripts/index.js\" root0=\"FORCE_HIGHLIGHTING\" />\r\n    <setting file=\"file://$PROJECT_DIR$/newsapp/forms.py\" root0=\"SKIP_INSPECTION\" />\r\n  </component>\r\n  <component name=\"ProjectId\" id=\"1r0XMYHC0A0L2Hrg5Ebf0r1WiJc\" />\r\n  <component name=\"ProjectLevelVcsManager\">\r\n    <ConfirmationsSetting value=\"2\" id=\"Add\" />\r\n  </component>\r\n  <component name=\"ProjectViewState\">\r\n    <option name=\"hideEmptyMiddlePackages\" value=\"true\" />\r\n    <option name=\"showLibraryContents\" value=\"true\" />\r\n  </component>\r\n  <component name=\"PropertiesComponent\">\r\n    <property name=\"ASKED_ADD_EXTERNAL_FILES\" value=\"true\" />\r\n    <property name=\"DatabaseDriversLRU\" value=\"sqlite\" />\r\n    <property name=\"DefaultHtmlFileTemplate\" value=\"HTML File\" />\r\n    <property name=\"RunOnceActivity.OpenProjectViewOnStart\" value=\"true\" />\r\n    <property name=\"RunOnceActivity.ShowReadmeOnStart\" value=\"true\" />\r\n    <property name=\"WebServerToolWindowFactoryState\" value=\"false\" />\r\n    <property name=\"last_opened_file_path\" value=\"$PROJECT_DIR$/../../新建文件夹\" />\r\n    <property name=\"list.type.of.created.stylesheet\" value=\"CSS\" />\r\n    <property name=\"restartRequiresConfirmation\" value=\"false\" />\r\n    <property name=\"settings.editor.selected.configurable\" value=\"com.alibabacloud.intellij.config.RegionConfigurable\" />\r\n  </component>\r\n  <component name=\"RecentsManager\">\r\n    <key name=\"CopyFile.RECENT_KEYS\">\r\n      <recent name=\"C:\\Users\\14253\\Desktop\\flower shop\\Online-flower-shop\\newsapp\\templates\" />\r\n      <recent name=\"C:\\Users\\14253\\Desktop\\flower shop\\Online-flower-shop\\newsapp\\static\\scripts\" />\r\n      <recent name=\"C:\\Users\\EZRA\\Desktop\\flower\\Online-flower-shop\\newsapp\\templates\" />\r\n      <recent name=\"C:\\Users\\EZRA\\Desktop\\flower\\Online-flower-shop\\newsapp\" />\r\n      <recent name=\"C:\\Users\\EZRA\\Desktop\\newFlower\\newFlower\\newsapp\\static\\images\" />\r\n    </key>\r\n  </component>\r\n  <component name=\"RunManager\" selected=\"Python.app\">\r\n    <configuration name=\"Deploy to Host\" type=\"DEPLOY_HOST_RUN_CONFIGURATION\" factoryName=\"Deploy to Host\">\r\n      <option name=\"accountModel\" />\r\n      <option name=\"accountModels\" />\r\n      <option name=\"address\" />\r\n      <option name=\"afterCommand\" value=\"nohup python3 /opt/Online-flower-shop/app.py &gt;&gt; /opt/Online-flower-shop/nohup.out &amp;   \" />\r\n      <option name=\"alreadyReset\" value=\"true\" />\r\n      <option name=\"autoOpen\" value=\"false\" />\r\n      <option name=\"beforeCommand\" value=\"rm -rf /opt/Online-flower-shop\" />\r\n      <option name=\"defaultTabIdx\" value=\"0\" />\r\n      <option name=\"ecsInstance\">\r\n        <EcsInstance>\r\n          <option name=\"OSType\" />\r\n          <option name=\"instanceId\" />\r\n          <option name=\"instanceName\" />\r\n          <option name=\"netType\" />\r\n          <option name=\"privateIps\" />\r\n          <option name=\"publicIps\" />\r\n          <option name=\"regionId\" />\r\n          <option name=\"tags\" />\r\n        </EcsInstance>\r\n      </option>\r\n      <option name=\"ecsInstances\" />\r\n      <option name=\"hostIds\">\r\n        <list>\r\n          <option value=\"1\" />\r\n        </list>\r\n      </option>\r\n      <option name=\"hostTagId\" value=\"0\" />\r\n      <option name=\"location\" value=\"/opt/\" />\r\n      <option name=\"pathOrUrl\" value=\"C:\\Users\\14253\\Desktop\\flower shop\\Online-flower-shop\" />\r\n      <option name=\"tagId\" value=\"0\" />\r\n      <option name=\"terminalCommand\" />\r\n      <option name=\"type\" value=\"HOST\" />\r\n      <option name=\"uploadType\" value=\"FILE\" />\r\n      <method v=\"2\" />\r\n    </configuration>\r\n    <configuration name=\"Online-flower-shop\" type=\"PythonConfigurationType\" factoryName=\"Python\">\r\n      <module name=\"Online-flower-shop\" />\r\n      <option name=\"INTERPRETER_OPTIONS\" value=\"\" />\r\n      <option name=\"PARENT_ENVS\" value=\"true\" />\r\n      <envs>\r\n        <env name=\"PYTHONUNBUFFERED\" value=\"1\" />\r\n      </envs>\r\n      <option name=\"SDK_HOME\" value=\"D:\\anaconda\\envs\\flasktest\\python.exe\" />\r\n      <option name=\"WORKING_DIRECTORY\" value=\"$PROJECT_DIR$\" />\r\n      <option name=\"IS_MODULE_SDK\" value=\"false\" />\r\n      <option name=\"ADD_CONTENT_ROOTS\" value=\"true\" />\r\n      <option name=\"ADD_SOURCE_ROOTS\" value=\"true\" />\r\n      <EXTENSION ID=\"PythonCoverageRunConfigurationExtension\" runner=\"coverage.py\" />\r\n      <option name=\"SCRIPT_NAME\" value=\"$PROJECT_DIR$/newsapp/__init__.py\" />\r\n      <option name=\"PARAMETERS\" value=\"\" />\r\n      <option name=\"SHOW_COMMAND_LINE\" value=\"false\" />\r\n      <option name=\"EMULATE_TERMINAL\" value=\"false\" />\r\n      <option name=\"MODULE_MODE\" value=\"false\" />\r\n      <option name=\"REDIRECT_INPUT\" value=\"false\" />\r\n      <option name=\"INPUT_FILE\" value=\"\" />\r\n      <method v=\"2\" />\r\n    </configuration>\r\n    <configuration default=\"true\" type=\"PythonConfigurationType\" factoryName=\"Python\">\r\n      <module name=\"newFlower\" />\r\n      <option name=\"INTERPRETER_OPTIONS\" value=\"\" />\r\n      <option name=\"PARENT_ENVS\" value=\"true\" />\r\n      <envs>\r\n        <env name=\"PYTHONUNBUFFERED\" value=\"1\" />\r\n      </envs>\r\n      <option name=\"SDK_HOME\" value=\"C:\\Users\\EZRA\\PycharmProjects\\newFlower\\venv\\Scripts\\python.exe\" />\r\n      <option name=\"WORKING_DIRECTORY\" value=\"$PROJECT_DIR$\" />\r\n      <option name=\"IS_MODULE_SDK\" value=\"false\" />\r\n      <option name=\"ADD_CONTENT_ROOTS\" value=\"true\" />\r\n      <option name=\"ADD_SOURCE_ROOTS\" value=\"true\" />\r\n      <EXTENSION ID=\"PythonCoverageRunConfigurationExtension\" runner=\"coverage.py\" />\r\n      <option name=\"SCRIPT_NAME\" value=\"$PROJECT_DIR$/app.py\" />\r\n      <option name=\"PARAMETERS\" value=\"\" />\r\n      <option name=\"SHOW_COMMAND_LINE\" value=\"false\" />\r\n      <option name=\"EMULATE_TERMINAL\" value=\"false\" />\r\n      <option name=\"MODULE_MODE\" value=\"false\" />\r\n      <option name=\"REDIRECT_INPUT\" value=\"false\" />\r\n      <option name=\"INPUT_FILE\" value=\"\" />\r\n      <method v=\"2\" />\r\n    </configuration>\r\n    <configuration name=\"app\" type=\"PythonConfigurationType\" factoryName=\"Python\" nameIsGenerated=\"true\">\r\n      <module name=\"Online-flower-shop\" />\r\n      <option name=\"INTERPRETER_OPTIONS\" value=\"\" />\r\n      <option name=\"PARENT_ENVS\" value=\"true\" />\r\n      <envs>\r\n        <env name=\"PYTHONUNBUFFERED\" value=\"1\" />\r\n      </envs>\r\n      <option name=\"SDK_HOME\" value=\"D:\\anaconda\\envs\\flasktest\\python.exe\" />\r\n      <option name=\"WORKING_DIRECTORY\" value=\"$PROJECT_DIR$\" />\r\n      <option name=\"IS_MODULE_SDK\" value=\"false\" />\r\n      <option name=\"ADD_CONTENT_ROOTS\" value=\"true\" />\r\n      <option name=\"ADD_SOURCE_ROOTS\" value=\"true\" />\r\n      <EXTENSION ID=\"PythonCoverageRunConfigurationExtension\" runner=\"coverage.py\" />\r\n      <option name=\"SCRIPT_NAME\" value=\"$PROJECT_DIR$/app.py\" />\r\n      <option name=\"PARAMETERS\" value=\"\" />\r\n      <option name=\"SHOW_COMMAND_LINE\" value=\"false\" />\r\n      <option name=\"EMULATE_TERMINAL\" value=\"false\" />\r\n      <option name=\"MODULE_MODE\" value=\"false\" />\r\n      <option name=\"REDIRECT_INPUT\" value=\"false\" />\r\n      <option name=\"INPUT_FILE\" value=\"\" />\r\n      <method v=\"2\" />\r\n    </configuration>\r\n    <list>\r\n      <item itemvalue=\"Deploy to Host.Deploy to Host\" />\r\n      <item itemvalue=\"Python.app\" />\r\n      <item itemvalue=\"Python.Online-flower-shop\" />\r\n    </list>\r\n  </component>\r\n  <component name=\"SpellCheckerSettings\" RuntimeDictionaries=\"0\" Folders=\"0\" CustomDictionaries=\"0\" DefaultDictionary=\"application-level\" UseSingleDictionary=\"true\" transferred=\"true\" />\r\n  <component name=\"SshConsoleOptionsProvider\">\r\n    <option name=\"myEncoding\" value=\"UTF-8\" />\r\n  </component>\r\n  <component name=\"TaskManager\">\r\n    <task active=\"true\" id=\"Default\" summary=\"Default task\">\r\n      <changelist id=\"a1e85ceb-f8b8-4f7a-a03d-aeda75464efe\" name=\"Default Changelist\" comment=\"\" />\r\n      <created>1618113933857</created>\r\n      <option name=\"number\" value=\"Default\" />\r\n      <option name=\"presentableId\" value=\"Default\" />\r\n      <updated>1618113933857</updated>\r\n      <workItem from=\"1618113955903\" duration=\"16139000\" />\r\n      <workItem from=\"1618142937532\" duration=\"432000\" />\r\n      <workItem from=\"1618144502071\" duration=\"7717000\" />\r\n      <workItem from=\"1618189653767\" duration=\"6191000\" />\r\n      <workItem from=\"1618318373758\" duration=\"4211000\" />\r\n      <workItem from=\"1618366308105\" duration=\"499000\" />\r\n      <workItem from=\"1618366949974\" duration=\"15839000\" />\r\n      <workItem from=\"1618471023939\" duration=\"13181000\" />\r\n      <workItem from=\"1618655537038\" duration=\"13847000\" />\r\n      <workItem from=\"1618708138653\" duration=\"4524000\" />\r\n      <workItem from=\"1618713663922\" duration=\"18820000\" />\r\n      <workItem from=\"1618794393631\" duration=\"20723000\" />\r\n      <workItem from=\"1618835686189\" duration=\"6024000\" />\r\n      <workItem from=\"1618968439275\" duration=\"13886000\" />\r\n      <workItem from=\"1618994295210\" duration=\"1711000\" />\r\n      <workItem from=\"1619054119868\" duration=\"474000\" />\r\n      <workItem from=\"1619405146430\" duration=\"624000\" />\r\n      <workItem from=\"1619793648010\" duration=\"6264000\" />\r\n      <workItem from=\"1619832775748\" duration=\"14211000\" />\r\n      <workItem from=\"1619922901921\" duration=\"8850000\" />\r\n      <workItem from=\"1620097217589\" duration=\"1762000\" />\r\n      <workItem from=\"1620267698033\" duration=\"1223000\" />\r\n      <workItem from=\"1620269331162\" duration=\"57000\" />\r\n      <workItem from=\"1620269391853\" duration=\"900000\" />\r\n      <workItem from=\"1620439028250\" duration=\"108000\" />\r\n      <workItem from=\"1620570184018\" duration=\"4031000\" />\r\n      <workItem from=\"1620575015517\" duration=\"925000\" />\r\n      <workItem from=\"1620607267363\" duration=\"7874000\" />\r\n      <workItem from=\"1620707400621\" duration=\"6297000\" />\r\n      <workItem from=\"1620717329442\" duration=\"62000\" />\r\n      <workItem from=\"1620717392927\" duration=\"11679000\" />\r\n      <workItem from=\"1620793134574\" duration=\"6794000\" />\r\n      <workItem from=\"1620867746581\" duration=\"5402000\" />\r\n      <workItem from=\"1621017348885\" duration=\"1855000\" />\r\n      <workItem from=\"1621132195947\" duration=\"85000\" />\r\n      <workItem from=\"1621132283762\" duration=\"12525000\" />\r\n      <workItem from=\"1621148686769\" duration=\"5882000\" />\r\n      <workItem from=\"1621222579957\" duration=\"8501000\" />\r\n      <workItem from=\"1621244384443\" duration=\"14491000\" />\r\n      <workItem from=\"1621300643697\" duration=\"2771000\" />\r\n      <workItem from=\"1621386560634\" duration=\"6828000\" />\r\n      <workItem from=\"1621475885667\" duration=\"2331000\" />\r\n      <workItem from=\"1621827273673\" duration=\"1215000\" />\r\n      <workItem from=\"1622094871187\" duration=\"10444000\" />\r\n      <workItem from=\"1622106229170\" duration=\"914000\" />\r\n      <workItem from=\"1622107159929\" duration=\"315000\" />\r\n    </task>\r\n    <servers />\r\n  </component>\r\n  <component name=\"TypeScriptGeneratedFilesManager\">\r\n    <option name=\"version\" value=\"3\" />\r\n  </component>\r\n  <component name=\"Vcs.Log.Tabs.Properties\">\r\n    <option name=\"TAB_STATES\">\r\n      <map>\r\n        <entry key=\"MAIN\">\r\n          <value>\r\n            <State />\r\n          </value>\r\n        </entry>\r\n      </map>\r\n    </option>\r\n    <option name=\"oldMeFiltersMigrated\" value=\"true\" />\r\n  </component>\r\n  <component name=\"VcsManagerConfiguration\">\r\n    <option name=\"ADD_EXTERNAL_FILES_SILENTLY\" value=\"true\" />\r\n  </component>\r\n  <component name=\"XDebuggerManager\">\r\n    <breakpoint-manager>\r\n      <breakpoints>\r\n        <line-breakpoint enabled=\"true\" suspend=\"THREAD\" type=\"python-line\">\r\n          <url>file://$PROJECT_DIR$/newsapp/routes.py</url>\r\n          <line>502</line>\r\n          <option name=\"timeStamp\" value=\"1\" />\r\n        </line-breakpoint>\r\n        <line-breakpoint enabled=\"true\" suspend=\"THREAD\" type=\"python-line\">\r\n          <url>file://$PROJECT_DIR$/newsapp/routes.py</url>\r\n          <line>624</line>\r\n          <option name=\"timeStamp\" value=\"7\" />\r\n        </line-breakpoint>\r\n        <line-breakpoint enabled=\"true\" suspend=\"THREAD\" type=\"python-line\">\r\n          <url>file://$PROJECT_DIR$/newsapp/routes.py</url>\r\n          <line>608</line>\r\n          <option name=\"timeStamp\" value=\"9\" />\r\n        </line-breakpoint>\r\n        <line-breakpoint enabled=\"true\" suspend=\"THREAD\" type=\"python-line\">\r\n          <url>file://$PROJECT_DIR$/newsapp/routes.py</url>\r\n          <line>572</line>\r\n          <option name=\"timeStamp\" value=\"10\" />\r\n        </line-breakpoint>\r\n        <line-breakpoint enabled=\"true\" suspend=\"THREAD\" type=\"python-line\">\r\n          <url>file://$PROJECT_DIR$/newsapp/routes.py</url>\r\n          <line>852</line>\r\n          <option name=\"timeStamp\" value=\"11\" />\r\n        </line-breakpoint>\r\n        <line-breakpoint enabled=\"true\" type=\"javascript\">\r\n          <url>file://$PROJECT_DIR$/newsapp/static/scripts/index1.js</url>\r\n          <line>1</line>\r\n          <option name=\"timeStamp\" value=\"3\" />\r\n        </line-breakpoint>\r\n        <line-breakpoint enabled=\"true\" type=\"javascript\">\r\n          <url>file://$PROJECT_DIR$/newsapp/static/scripts/review.js</url>\r\n          <line>2</line>\r\n          <option name=\"timeStamp\" value=\"8\" />\r\n        </line-breakpoint>\r\n      </breakpoints>\r\n    </breakpoint-manager>\r\n  </component>\r\n  <component name=\"com.intellij.coverage.CoverageDataManagerImpl\">\r\n    <SUITE FILE_PATH=\"coverage/newFlower$app.coverage\" NAME=\"app Coverage Results\" MODIFIED=\"1618492058809\" SOURCE_PROVIDER=\"com.intellij.coverage.DefaultCoverageFileProvider\" RUNNER=\"coverage.py\" COVERAGE_BY_TEST_ENABLED=\"true\" COVERAGE_TRACING_ENABLED=\"false\" WORKING_DIRECTORY=\"$PROJECT_DIR$\" />\r\n    <SUITE FILE_PATH=\"coverage/Online_flower_shop$Online_flower_shop.coverage\" NAME=\"Online-flower-shop Coverage Results\" MODIFIED=\"1620740272172\" SOURCE_PROVIDER=\"com.intellij.coverage.DefaultCoverageFileProvider\" RUNNER=\"coverage.py\" COVERAGE_BY_TEST_ENABLED=\"true\" COVERAGE_TRACING_ENABLED=\"false\" WORKING_DIRECTORY=\"$PROJECT_DIR$\" />\r\n    <SUITE FILE_PATH=\"coverage/Online_flower_shop$app.coverage\" NAME=\"app Coverage Results\" MODIFIED=\"1622107329835\" SOURCE_PROVIDER=\"com.intellij.coverage.DefaultCoverageFileProvider\" RUNNER=\"coverage.py\" COVERAGE_BY_TEST_ENABLED=\"true\" COVERAGE_TRACING_ENABLED=\"false\" WORKING_DIRECTORY=\"$PROJECT_DIR$\" />\r\n    <SUITE FILE_PATH=\"coverage/newFlower4_17$app.coverage\" NAME=\"app Coverage Results\" MODIFIED=\"1618708256048\" SOURCE_PROVIDER=\"com.intellij.coverage.DefaultCoverageFileProvider\" RUNNER=\"coverage.py\" COVERAGE_BY_TEST_ENABLED=\"true\" COVERAGE_TRACING_ENABLED=\"false\" WORKING_DIRECTORY=\"$PROJECT_DIR$\" />\r\n  </component>\r\n</project>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/.idea/workspace.xml b/.idea/workspace.xml
--- a/.idea/workspace.xml	(revision cd272d0a83316b4d9bc5b4c8524ccdd7ef6890fd)
+++ b/.idea/workspace.xml	(date 1622124414089)
@@ -6,13 +6,9 @@
   <component name="ChangeListManager">
     <list default="true" id="a1e85ceb-f8b8-4f7a-a03d-aeda75464efe" name="Default Changelist" comment="Merge remote-tracking branch 'origin/y5.27' into main&#10;&#10;# Conflicts:&#10;#&#9;newsapp/__pycache__/forms.cpython-38.pyc&#10;#&#9;newsapp/__pycache__/routes.cpython-38.pyc&#10;#&#9;newsapp/newsdb.db">
       <change beforePath="$PROJECT_DIR$/.idea/workspace.xml" beforeDir="false" afterPath="$PROJECT_DIR$/.idea/workspace.xml" afterDir="false" />
-      <change beforePath="$PROJECT_DIR$/app.py" beforeDir="false" afterPath="$PROJECT_DIR$/app.py" afterDir="false" />
       <change beforePath="$PROJECT_DIR$/newsapp/models.py" beforeDir="false" afterPath="$PROJECT_DIR$/newsapp/models.py" afterDir="false" />
       <change beforePath="$PROJECT_DIR$/newsapp/newsdb.db" beforeDir="false" afterPath="$PROJECT_DIR$/newsapp/newsdb.db" afterDir="false" />
       <change beforePath="$PROJECT_DIR$/newsapp/routes.py" beforeDir="false" afterPath="$PROJECT_DIR$/newsapp/routes.py" afterDir="false" />
-      <change beforePath="$PROJECT_DIR$/newsapp/static/css/style.css" beforeDir="false" afterPath="$PROJECT_DIR$/newsapp/static/css/style.css" afterDir="false" />
-      <change beforePath="$PROJECT_DIR$/newsapp/static/scripts/review.js" beforeDir="false" afterPath="$PROJECT_DIR$/newsapp/static/scripts/review.js" afterDir="false" />
-      <change beforePath="$PROJECT_DIR$/newsapp/templates/newproduct-details.html" beforeDir="false" afterPath="$PROJECT_DIR$/newsapp/templates/newproduct-details.html" afterDir="false" />
     </list>
     <option name="SHOW_DIALOG" value="false" />
     <option name="HIGHLIGHT_CONFLICTS" value="true" />
@@ -251,7 +247,8 @@
       <workItem from="1621827273673" duration="1215000" />
       <workItem from="1622094871187" duration="10444000" />
       <workItem from="1622106229170" duration="914000" />
-      <workItem from="1622107159929" duration="315000" />
+      <workItem from="1622107159929" duration="836000" />
+      <workItem from="1622116939410" duration="3617000" />
     </task>
     <servers />
   </component>
@@ -278,28 +275,28 @@
       <breakpoints>
         <line-breakpoint enabled="true" suspend="THREAD" type="python-line">
           <url>file://$PROJECT_DIR$/newsapp/routes.py</url>
-          <line>502</line>
+          <line>513</line>
           <option name="timeStamp" value="1" />
         </line-breakpoint>
         <line-breakpoint enabled="true" suspend="THREAD" type="python-line">
           <url>file://$PROJECT_DIR$/newsapp/routes.py</url>
-          <line>624</line>
-          <option name="timeStamp" value="7" />
+          <line>864</line>
+          <option name="timeStamp" value="11" />
         </line-breakpoint>
         <line-breakpoint enabled="true" suspend="THREAD" type="python-line">
           <url>file://$PROJECT_DIR$/newsapp/routes.py</url>
-          <line>608</line>
-          <option name="timeStamp" value="9" />
+          <line>650</line>
+          <option name="timeStamp" value="12" />
         </line-breakpoint>
         <line-breakpoint enabled="true" suspend="THREAD" type="python-line">
           <url>file://$PROJECT_DIR$/newsapp/routes.py</url>
-          <line>572</line>
-          <option name="timeStamp" value="10" />
+          <line>1345</line>
+          <option name="timeStamp" value="14" />
         </line-breakpoint>
         <line-breakpoint enabled="true" suspend="THREAD" type="python-line">
           <url>file://$PROJECT_DIR$/newsapp/routes.py</url>
-          <line>852</line>
-          <option name="timeStamp" value="11" />
+          <line>1335</line>
+          <option name="timeStamp" value="15" />
         </line-breakpoint>
         <line-breakpoint enabled="true" type="javascript">
           <url>file://$PROJECT_DIR$/newsapp/static/scripts/index1.js</url>
@@ -317,7 +314,7 @@
   <component name="com.intellij.coverage.CoverageDataManagerImpl">
     <SUITE FILE_PATH="coverage/newFlower$app.coverage" NAME="app Coverage Results" MODIFIED="1618492058809" SOURCE_PROVIDER="com.intellij.coverage.DefaultCoverageFileProvider" RUNNER="coverage.py" COVERAGE_BY_TEST_ENABLED="true" COVERAGE_TRACING_ENABLED="false" WORKING_DIRECTORY="$PROJECT_DIR$" />
     <SUITE FILE_PATH="coverage/Online_flower_shop$Online_flower_shop.coverage" NAME="Online-flower-shop Coverage Results" MODIFIED="1620740272172" SOURCE_PROVIDER="com.intellij.coverage.DefaultCoverageFileProvider" RUNNER="coverage.py" COVERAGE_BY_TEST_ENABLED="true" COVERAGE_TRACING_ENABLED="false" WORKING_DIRECTORY="$PROJECT_DIR$" />
-    <SUITE FILE_PATH="coverage/Online_flower_shop$app.coverage" NAME="app Coverage Results" MODIFIED="1622107329835" SOURCE_PROVIDER="com.intellij.coverage.DefaultCoverageFileProvider" RUNNER="coverage.py" COVERAGE_BY_TEST_ENABLED="true" COVERAGE_TRACING_ENABLED="false" WORKING_DIRECTORY="$PROJECT_DIR$" />
+    <SUITE FILE_PATH="coverage/Online_flower_shop$app.coverage" NAME="app Coverage Results" MODIFIED="1622124044227" SOURCE_PROVIDER="com.intellij.coverage.DefaultCoverageFileProvider" RUNNER="coverage.py" COVERAGE_BY_TEST_ENABLED="true" COVERAGE_TRACING_ENABLED="false" WORKING_DIRECTORY="$PROJECT_DIR$" />
     <SUITE FILE_PATH="coverage/newFlower4_17$app.coverage" NAME="app Coverage Results" MODIFIED="1618708256048" SOURCE_PROVIDER="com.intellij.coverage.DefaultCoverageFileProvider" RUNNER="coverage.py" COVERAGE_BY_TEST_ENABLED="true" COVERAGE_TRACING_ENABLED="false" WORKING_DIRECTORY="$PROJECT_DIR$" />
   </component>
 </project>
\ No newline at end of file
